var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};
$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;
$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};
$jscomp.polyfill("String.prototype.endsWith",function(a){return a?a:function(a,c){var b=$jscomp.checkStringArgs(this,a,"endsWith");a+="";void 0===c&&(c=b.length);c=Math.max(0,Math.min(c|0,b.length));for(var e=a.length;0<e&&0<c;)if(b[--c]!=a[--e])return!1;return 0>=e}},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.SymbolClass=function(a,b){this.$jscomp$symbol$id_=a;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:b})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function a(c){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(c||"")+"_"+b++,c)}var b=0;return a}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};
$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var c=0,d={next:function(){if(c<a.length){var e=c++;return{value:b(e,a[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(a,c){var b=$jscomp.checkStringArgs(this,a,"startsWith");a+="";var e=b.length,g=a.length;c=Math.max(0,Math.min(c|0,b.length));for(var f=0;f<g&&c<e;)if(b[c++]!=a[f++])return!1;return f>=g}},"es6","es3");$jscomp.polyfill("Array.prototype.entries",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a,c){return[a,c]})}},"es6","es3");window.onresize=screenManager;
var pad=20,minWidth=400,maxWidth=900,canvasAspectRatio=3,mainPanel=null,scheduleField=null,refreshBtn=null,selectors=[],plotterHeaderHeight=60,plotterWrapper=null,plotterWrapperHeight=0,plotterHeader=null,plotter=null,ctx=null,plotterHeaderMargin=20,canvasBasesize=[1200,null],canvasMargin=20,exampleIDFName="example",exampleIDFExt=".idf",exampleIDFCode="Schedule:Compact,\n    BLDG_OCC_SCH,            !- Name\n    Fraction,                !- Schedule Type Limits Name\n    Through: 12/31,          !- Field 1\n    For: Weekdays,           !- Field 2\n    Until: 06:00,0.0,        !- Field 3\n    Until: 07:00,0.1,        !- Field 5\n    Until: 08:00,0.2,        !- Field 7\n    Until: 12:00,0.95,       !- Field 9\n    Until: 13:00,0.5,        !- Field 11\n    Until: 17:00,0.95,       !- Field 13\n    Until: 18:00,0.3,        !- Field 15\n    Until: 22:00,0.1,        !- Field 17\n    Until: 24:00,0.05,       !- Field 19\n    For: SummerDesignDay,    !- Field 21\n    Until: 06:00,0.000000001,!- Field 22\n    Until: 22:00,1.0,        !- Field 24\n    Until: 24:00,0.05,       !- Field 26\n    For: Saturday,           !- Field 28\n    Until: 06:00,0.0,        !- Field 29\n    Until: 08:00,0.1,        !- Field 31\n    Until: 12:00,0.3,        !- Field 33\n    Until: 17:00,0.1,        !- Field 35\n    Until: 19:00,0.05,       !- Field 37\n    Until: 24:00,0.0,        !- Field 39\n    For: WinterDesignDay,    !- Field 41\n    Until: 24:00,0.0,        !- Field 42\n    For:Sunday Holidays AllOtherDays, !- Field 44\n    Until: 06:00,0.0,        !- Field 45\n    Until: 18:00,0.05,       !- Field 47\n    Until: 24:00,0.0;        !- Field 49\nSchedule:Compact,\n    CLOTHING_SCH,            !- Name\n    Any Number,              !- Schedule Type Limits Name\n    Through: 04/30,          !- Field 1\n    For: AllDays,            !- Field 2\n    Until: 24:00,1.0,        !- Field 3\n    Through: 09/30,          !- Field 5\n    For: AllDays,            !- Field 6\n    Until: 24:00,0.5,        !- Field 7\n    Through: 12/31,          !- Field 9\n    For: AllDays,            !- Field 10\n    Until: 24:00,1.0;        !- Field 11",
idfName="",idfExt="",scheduleCompact={},selectedSch="",selectedThr="",selectedFor="",dropdownNum=0,dropdownItemHeight=35,dropdownPfx=["Sch","Thr","For"],dropdownLength=[0,0,0],dropdownIdx=[0,0,0],dropdownName=["","",""],dropdownItemLists=[[],[],[]],stylePanel=null,btnDarkMode=null,btnShowSchName=null,btnShowSchVals=null,btnCopyValues=null;
function initialize(){mainPanel=document.getElementById("mainPanel");plotterWrapper=document.getElementById("plotterWrapper");plotterHeader=document.getElementById("headerTable");plotter=document.getElementById("plotter");ctx=plotter.getContext("2d");plotterHeader.style.height=plotterHeaderHeight+"px";plotterHeaderRight=0;for(var a=1;5>a;a++)plotterHeaderRight+=plotterHeader.rows[0].cells[a].offsetWidth;a=document.getElementsByClassName("dropdown");dropdownNum=a.length;a=$jscomp.makeIterator(a);for(var b=
a.next();!b.done;b=a.next())b.value.style.height="0px";canvasBasesize[1]=canvasBasesize[0]/canvasAspectRatio;ctx.canvas.width=canvasBasesize[0];ctx.canvas.height=canvasBasesize[1];stylePanel=document.getElementById("stylePanel");btnDarkMode=document.getElementById("btnDarkMode");btnShowSchName=document.getElementById("btnShowSchName");btnShowSchVals=document.getElementById("btnShowSchVals");btnCopyValues=document.getElementById("btnCopyValues")}
function screenManager(){var a=document.body.clientWidth-2*pad;if(a<minWidth){var b=pad;a=minWidth}else a<maxWidth?b=pad:(b=pad+(a-maxWidth)/2,a=maxWidth);mainPanel.style.marginLeft=b+"px";mainPanel.style.marginRight=b+"px";mainPanel.style.width=a+"px";plotterWidth=plotterWrapper.clientWidth-2*canvasMargin;plotterHeaderWidth=plotterWrapper.clientWidth-2*plotterHeaderMargin;plotterHeight=plotterWidth/canvasAspectRatio;plotterWrapperHeight=plotterHeight+2*plotterHeaderHeight+10+20;plotterWrapper.style.height=
plotterWrapperHeight+"px";plotter.style.width=plotterWidth+"px";plotter.style.height=plotterHeight+"px";selectorSch.style.width=plotterHeaderWidth-plotterHeaderRight+"px";b=plotterHeader.getElementsByClassName("selector");for(a=0;a<b.length;a++){var c=b[a];dropdown=c.querySelector(".dropdown");dropdown.style.width="fit-content";dropdown.clientWidth<=c.clientWidth?dropdown.style.width="100%":0==a?dropdown.style.left="0px":dropdown.style.right="0px"}}
function updateScrollFades(a){var b=0>=a.scrollTop,c=1>Math.abs(a.scrollHeight-a.clientHeight-a.scrollTop);a.classList.toggle("at-top",b);a.classList.toggle("at-bottom",c);a.classList.add("scrolling");console.log(b,c)}
function changeBtnState(a){0==a?(refreshBtn.style.visibility="hidden",refreshBtn.style.opacity=0,refreshBtn.style.width="0px",refreshBtn.style.paddingLeft="25px",refreshBtn.classList.remove("fadeinSlideHor"),refreshBtn.classList.add("fadeoutSlideHor")):(refreshBtn.style.opacity=1,refreshBtn.style.visibility="visible",refreshBtn.style.width="100px",refreshBtn.style.paddingLeft="0px",refreshBtn.classList.remove("fadeoutSlideHor"),refreshBtn.classList.add("fadeinSlideHor"))}
function changeTextAreaColor(a){scheduleField.style.backgroundColor=0==a?"rgba(0,0,0,0.33)":1==a?"rgba(7, 220, 78, 0.33)":"rgba(255, 0, 0, 0.33)"}function loadExampleFile(){idfName=exampleIDFName;idfExt=exampleIDFExt;update(exampleIDFCode)}
function readFile(a){if(0<a.length){idfFile=a[0];if(idfFile.name.endsWith(".idf"))idfName=idfFile.name.slice(0,-4),idfExt=".idf";else if(idfFile.name.endsWith(".expidf"))idfName=idfFile.name.slice(0,-7),idfExt=".expidf";else{window.alert("Only .idf, .expidf formats supported!");return}reader.readAsText(idfFile,"utf-8")}}var reader=new FileReader;reader.onload=function(){update(reader.result)};var fileSelector=document.getElementById("fileSelector"),fileSelectorTag=document.getElementById("fileSelectorTag");
fileSelector.addEventListener("change",function(a){readFile(a.target.files)});document.body.addEventListener("drop",function(a){a.stopPropagation();a.preventDefault();clickable=!0;fileHoverMask.style.display="none";fileHover.style.display="none";readFile(a.dataTransfer.files)});var fileHoverMask=document.getElementById("fileHoverMask"),fileHover=document.getElementById("fileHover");
document.body.addEventListener("dragover",function(a){a.stopPropagation();a.preventDefault();a.dataTransfer.dropEffect="copy";clickable=!1;fileHoverMask.style.display="block";fileHover.style.display="block"});fileHoverMask.addEventListener("dragleave",function(a){clickable=!0;fileHoverMask.style.display="none";fileHover.style.display="none"});
function update(a){result=parseCode(a);dropdownItemLists=[Object.keys(scheduleCompact)].concat(Array(dropdownNum-1));0<Object.keys(scheduleCompact).length?toggleStylePanel(0):(result=-1,toggleStylePanel(-1));drawPlot(-1);updateScheduleList(result);fileSelectorTag.innerHTML=""==idfName?"":idfName+idfExt}
function parseCode(a){scheduleCompact={};selectedSch="";codeCheck=!1;if(0>=a.length)return-1;a=a.replace(/!.+\s*/g,"");a=a.replace(/,\s*/g,",").replace(/;\s*/g,";");a.split(";").forEach(function(a){a=a.split(",");var b=0;var d=null;var e="",g="";if("schedule:compact"==a[0].toLowerCase())for(var f=0;f<a.length;f++){var k=a[f];if(k.toLowerCase().startsWith("schedule:compact")){if(0!=f)return-1;b=1}else if(1==b)b=2,d=k,scheduleCompact[d]={},d=scheduleCompact[d];else if(2==b)b=3,d.type=k,d.sch={};else if(3==
b)if(lineNoSpace=k.replace(/\s/g,""),lineLowerCase=lineNoSpace.toLowerCase(),lineLowerCase.startsWith("through"))e=lineNoSpace.match(/through[: ]+(\S+)/i)[1],d.sch[e]={};else if(lineLowerCase.startsWith("for")){forsValue=k.match(/for[: ]+(\S+)/i)[1];fors=forsValue.split(/\s+/);if(1>fors.length)return-1;g=fors.join(" / ");d.sch[e][g]=[]}else lineLowerCase.startsWith("until")?(timeString=lineNoSpace.match(/until[: ]+(\S+)/i)[1],timeStringMatched=timeString.match(/(\d+):(\d+)/),time_h=parseFloat(timeStringMatched[1]),
time_m=parseFloat(timeStringMatched[2]),endH=time_h+time_m/60):(value=parseFloat(lineLowerCase),isNaN(value)&&(b=-1),d.sch[e][g].push([endH,value]))}});return 1}function updateScheduleList(a){if(0>a){a=$jscomp.makeIterator(document.getElementsByClassName("selector"));for(var b=a.next();!b.done;b=a.next())b=b.value,b.parentElement!=stylePanel&&(b.disabled=!0,b.querySelector(".selectorText").innerHTML="...")}else updateDropdown(0,0),toggleStylePanel(1)}
function updateDropdown(a,b,c){c=void 0===c?!0:c;dropdownIdx[a]=b;switch(a){case 0:keys=dropdownItemLists[0];selectedSch=keys[b];break;case 1:keys=Object.keys(scheduleCompact[dropdownName[0]].sch);selectedThr=keys[b];break;case 2:keys=Object.keys(scheduleCompact[dropdownName[0]].sch[dropdownName[1]]),selectedFor=keys[b]}0<a&&(dropdownItemLists[a]=keys);dropdownName[a]=keys[b];dropdownLength[a]=keys.length;var d=document.getElementById("selector"+dropdownPfx[a]);d.querySelector(".selectorText").innerHTML=
keys[b];d.disabled=1<dropdownLength[a]?!1:!0;b=document.getElementById("dropdown"+dropdownPfx[a]);if(c){b.innerHTML="";c=$jscomp.makeIterator(keys.entries());for(var e=c.next();!e.done;e=c.next()){var g=$jscomp.makeIterator(e.value);e=g.next().value;g=g.next().value;b.innerHTML+='<div class="dropdownItem" onclick="updateDropdown('+a+", "+e+', false);">'+g+"</div>"}}b.style.width="fit-content";b.clientWidth<=d.clientWidth?b.style.width="100%":0==a?b.style.left="0px":b.style.right="0px";a<dropdownNum-
1?updateDropdown(a+1,0):drawPlot(1)}
function dropdownToggle(a,b){dropdown=document.getElementById("dropdown"+dropdownPfx[a]);0>b?(dropdown.classList.remove("fadeinSlideVer"),dropdown.classList.add("fadeoutSlideVer"),dropdown.style.visibility="hidden",dropdown.style.opacity=0,dropdown.style.height="0px"):0<b?(dropdown.classList.remove("fadeoutSlideVer"),dropdown.classList.add("fadeinSlideVer"),dropdown.style.visibility="visible",dropdown.style.opacity=1,dropdown.style.height="min("+dropdownLength[a]*dropdownItemHeight+"px, "+(plotterWrapperHeight-
plotterHeaderHeight-20)+"px)"):"visible"==dropdown.style.visibility?dropdownToggle(a,-1):dropdownToggle(a,1)}function remap(a,b,c){return b[0]==b[1]?(c[1]-c[0])/2+c[0]:(a-b[0])/(b[1]-b[0])*(c[1]-c[0])+c[0]}var darkMode=!0,showSchName=!0,showSchVals=!0,defaultHighlightColor="#9ee3ff",highlightColor=defaultHighlightColor;
function toggleStylePanel(a){0>=a?(stylePanel.style.display="none",0>a&&(darkModeToggle(1,-1),schNameShowToggle(1,-1),changeHighlightColor(defaultHighlightColor,-1))):stylePanel.style.display=""}function darkModeToggle(a,b){b=void 0===b?1:b;switch(void 0===a?0:a){case 0:darkMode=!darkMode;break;case -1:darkMode=!1;break;case 1:darkMode=!0}btnDarkMode.innerHTML=darkMode?"light mode":"dark mode";document.getElementById("plotterBG").style.backgroundColor=darkMode?"":"white";drawPlot(b)}
function schNameShowToggle(a,b){switch(void 0===a?0:a){case 0:showSchName=!showSchName;break;case -1:showSchName=!1;break;case 1:showSchName=!0}btnShowSchName.innerHTML=showSchName?"hide schedule type":"show schedule type";drawPlot(void 0===b?1:b)}function schValsShowToggle(a,b){switch(void 0===a?0:a){case 0:showSchVals=!showSchVals;break;case -1:showSchVals=!1;break;case 1:showSchVals=!0}btnShowSchVals.innerHTML=showSchVals?"hide values":"show values";drawPlot(void 0===b?1:b)}
function changeHighlightColor(a,b){highlightColor=a;drawPlot(void 0===b?1:b)}
function drawPlot(a){ctx.clearRect(0,0,canvasBasesize[0],canvasBasesize[1]);if(!(0>a)){valList=scheduleCompact[dropdownName[0]].sch[dropdownName[1]][dropdownName[2]];var b=20/plotterWidth*canvasBasesize[0];a=2+b;b=[canvasBasesize[0]-a-(2+b),canvasBasesize[1]-50-32];var c=b[0]/24,d=darkMode?"Roboto":"Times New Roman",e=[Math.min.apply(Math,$jscomp.arrayFromIterable(valList.map(function(a){return a[1]}))),Math.max.apply(Math,$jscomp.arrayFromIterable(valList.map(function(a){return a[1]})))],g=[50+b[1]-
25,75];ctx.beginPath();for(var f=0;24>f;f++)ctx.moveTo(a+f*c,50),ctx.lineTo(a+f*c,50+b[1]);ctx.strokeStyle=darkMode?"rgba(255,255,255, 0.5)":"rgba(0,0,0, 0.5)";ctx.lineWidth=2;ctx.setLineDash([10,6]);ctx.stroke();ctx.setLineDash([]);showSchName&&(ctx.textAlign="left",ctx.textBaseline="alphabetic",ctx.font="bold 25px "+d,ctx.fillStyle=darkMode?"rgba(255,255,255, 0.6)":"black",ctx.fillText("NAME",a,30),ctx.font="normal 35px "+d,ctx.fillStyle=highlightColor,ctx.fillText(dropdownName[0],a+(darkMode?80:
85),30));ctx.font="normal 20px "+d;ctx.textAlign="center";ctx.fillStyle=darkMode?"rgba(255,255,255, 0.6)":"black";ctx.beginPath();f=null;for(var k=$jscomp.makeIterator(valList),h=k.next();!h.done;h=k.next()){h=$jscomp.makeIterator(h.value);var m=h.next().value;h=h.next().value;m=a+m*c;var l=remap(h,e,g);null===f?(f=a,ctx.moveTo(f,l)):ctx.lineTo(f,l);ctx.lineTo(m,l);showSchVals&&(l-4-20>g[1]?(ctx.textBaseline="bottom",fontY=l-4):(ctx.textBaseline="top",fontY=l+4),ctx.fillText(h.toFixed(2),(f+m)/2,
fontY,c));f=m}ctx.strokeStyle=highlightColor;ctx.lineWidth=6;ctx.stroke();ctx.font="bold 25px "+d;ctx.textAlign="center";ctx.textBaseline="top";ctx.fillStyle=darkMode?"rgba(255,255,255, 0.8)":"black";for(d=0;24>=d;d++)ctx.fillText(d,a+d*c,50+b[1]+10);ctx.strokeStyle=darkMode?"white":"black";ctx.lineWidth=4;ctx.strokeRect(a,50,b[0],b[1])}}
function exportImage(){console.log("exporting image...");var a=plotter.toDataURL("image/png").replace("image/png","image/octet-stream"),b=document.createElement("a");b.setAttribute("href",a);b.setAttribute("download",idfName+"-"+selectedSch+"-"+selectedThr.replace("/","")+"-"+selectedFor+".png");document.body.appendChild(b);b.click();b.remove()}
function copyToClipBoard(a){0>a?btnCopyValues.innerHTML="copy values":navigator.clipboard?navigator.clipboard.writeText("test").then(function(){console.log("Values copied to clipboard...");btnCopyValues.innerHTML="copied"}).catch(function(a){console.log("Something went wrong",a)}):console.warn("Clipboard API not available")};
