var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var c=0;return function(){return c<a.length?{done:!1,value:a[c++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var c="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return c?c.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var c,d=[];!(c=a.next()).done;)d.push(c.value);return d};
$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};$jscomp.owns=function(a,c){return Object.prototype.hasOwnProperty.call(a,c)};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,d){a!=Array.prototype&&a!=Object.prototype&&(a[c]=d.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,c,d,e){if(c){d=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var f=a[e];f in d||(d[f]={});d=d[f]}a=a[a.length-1];e=d[a];c=c(e);c!=e&&null!=c&&$jscomp.defineProperty(d,a,{configurable:!0,writable:!0,value:c})}};
$jscomp.polyfill("Object.entries",function(a){return a?a:function(a){var c=[],e;for(e in a)$jscomp.owns(a,e)&&c.push([e,a[e]]);return c}},"es8","es3");$jscomp.polyfill("Math.sign",function(a){return a?a:function(a){a=Number(a);return 0===a||isNaN(a)?a:0<a?1:-1}},"es6","es3");
$jscomp.polyfill("Array.prototype.flat",function(a){return a?a:function(a){a=void 0===a?1:a;for(var c=[],e=0;e<this.length;e++){var f=this[e];Array.isArray(f)&&0<a?(f=Array.prototype.flat.call(f,a-1),c.push.apply(c,f)):c.push(f)}return c}},"es9","es5");
$jscomp.checkStringArgs=function(a,c,d){if(null==a)throw new TypeError("The 'this' value for String.prototype."+d+" must not be null or undefined");if(c instanceof RegExp)throw new TypeError("First argument to String.prototype."+d+" must not be a regular expression");return a+""};
$jscomp.polyfill("String.prototype.endsWith",function(a){return a?a:function(a,d){var c=$jscomp.checkStringArgs(this,a,"endsWith");a+="";void 0===d&&(d=c.length);d=Math.max(0,Math.min(d|0,c.length));for(var f=a.length;0<f&&0<d;)if(c[--d]!=a[--f])return!1;return 0>=f}},"es6","es3");
$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(a,d){var c=$jscomp.checkStringArgs(this,a,"startsWith");a+="";var f=c.length,h=a.length;d=Math.max(0,Math.min(d|0,c.length));for(var k=0;k<h&&d<f;)if(c[d++]!=a[k++])return!1;return k>=h}},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.SymbolClass=function(a,c){this.$jscomp$symbol$id_=a;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:c})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function a(d){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(d||"")+"_"+c++,d)}var c=0;return a}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};
$jscomp.iteratorFromArray=function(a,c){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var d=0,e={next:function(){if(d<a.length){var f=d++;return{value:c(f,a[f]),done:!1}}e.next=function(){return{done:!0,value:void 0}};return e.next()}};e[Symbol.iterator]=function(){return e};return e};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
$jscomp.polyfill("Object.fromEntries",function(a){return a?a:function(a){var c={};$jscomp.initSymbolIterator();if(!(Symbol.iterator in a))throw new TypeError(""+a+" is not iterable");a=a[Symbol.iterator].call(a);for(var e=a.next();!e.done;e=a.next()){e=e.value;if(Object(e)!==e)throw new TypeError("iterable for fromEntries should yield objects");c[e[0]]=e[1]}return c}},"es_2019","es3");
$jscomp.polyfill("Object.is",function(a){return a?a:function(a,d){return a===d?0!==a||1/a===1/d:a!==a&&d!==d}},"es6","es3");$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(a,d){var c=this;c instanceof String&&(c=String(c));var f=c.length;d=d||0;for(0>d&&(d=Math.max(d+f,0));d<f;d++){var h=c[d];if(h===a||Object.is(h,a))return!0}return!1}},"es7","es3");
$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(a,d){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,d||0)}},"es6","es3");
$jscomp.polyfill("Array.from",function(a){return a?a:function(a,d,e){d=null!=d?d:function(a){return a};var c=[],h="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];if("function"==typeof h){a=h.call(a);for(var k=0;!(h=a.next()).done;)c.push(d.call(e,h.value,k++))}else for(h=a.length,k=0;k<h;k++)c.push(d.call(e,a[k],k));return c}},"es6","es3");Math.radians=function(a){return a*Math.PI/180};Math.degrees=function(a){return 180*a/Math.PI};
var clamp=function(a,c,d){return Math.min(Math.max(a,c),d)},THRESHOLD=1E-4,matEdge=new THREE.LineBasicMaterial({color:0,linewidth:1}),matEdge2=new LineMaterial({color:"#000000",linewidth:1,alphaToCoverage:!1}),axisLength=10,axisXObjTemplate=new THREE.Line((new THREE.BufferGeometry).setFromPoints([new THREE.Vector3(0,0,0),new THREE.Vector3(axisLength,0,0)]),new THREE.LineBasicMaterial({color:16711680})),axisYObjTemplate=new THREE.Line((new THREE.BufferGeometry).setFromPoints([new THREE.Vector3(0,0,
0),new THREE.Vector3(0,axisLength,0)]),new THREE.LineBasicMaterial({color:65280})),axisZObjTemplate=new THREE.Line((new THREE.BufferGeometry).setFromPoints([new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,axisLength)]),new THREE.LineBasicMaterial({color:255})),axisTrueNorthObjTemplate=new THREE.Line((new THREE.BufferGeometry).setFromPoints([new THREE.Vector3(0,0,0),new THREE.Vector3(0,axisLength,0)]),new THREE.LineDashedMaterial({color:65280,linewidth:2,dashSize:1.5,gapSize:1}));axisTrueNorthObjTemplate.computeLineDistances();
var shadowCatcherMat=new THREE.ShadowMaterial;shadowCatcherMat.opacity=.5;var matGhost=new THREE.MeshBasicMaterial({color:0,side:THREE.DoubleSide,transparent:!0,blending:THREE.AdditiveBlending}),idfName="",idfExt="",northAxis=0,boundary=[],bldgRadius=0,bldgCenter=new THREE.Vector3,zoneList=[],constList=[],surfList={},fenList={},shadeList={},geometryList={},shadowCatcher=null,savedMeshEdges=[],scene=new THREE.Scene;scene.background=null;
var camera=new THREE.PerspectiveCamera(fov=30,aspect=canvWidth/canvHeight,near=.1,far=1E3);camera.up=new THREE.Vector3(0,0,1);var lightDirect=new THREE.DirectionalLight(15658734,.6),lightDirectTarget=new THREE.Object3D,lightAmbient=new THREE.AmbientLight(8947848),lightShadow=new THREE.DirectionalLight(15658734,0);lightShadow.shadow.mapSize.width=1024;lightShadow.shadow.mapSize.height=1024;
var lightShadowTarget=new THREE.Object3D,DEV=!1,matDev=new THREE.MeshPhongMaterial({color:16776960}),geomDev=new THREE.SphereGeometry(3,8,4),objDev=new THREE.Mesh(geomDev,matDev),renderer=new THREE.WebGLRenderer({alpha:!0,antialias:!0,preserveDrawingBuffer:!0});renderer.setClearColor(16777215,0);renderer.setSize(canvWidth,canvHeight);renderer.domElement.id="CanvasRenderer";document.getElementById("CanvasContainer").appendChild(renderer.domElement);renderer.domElement.style.width="100%";
renderer.domElement.style.height="100%";var CanvasRenderer=renderer.domElement;function exportImage(){console.log("exporting image...");var a=CanvasRenderer.toDataURL("image/png").replace("image/png","image/octet-stream"),c=document.createElement("a");c.setAttribute("href",a);c.setAttribute("download",idfName+".png");document.body.appendChild(c);c.click();c.remove()}var settingsPanelContent=document.getElementById("SettingsPanelContent");
function changeZoneAll(a){for(var c=$jscomp.makeIterator(Object.entries(zoneList)),d=c.next();!d.done;d=c.next()){d=$jscomp.makeIterator(d.value);var e=d.next().value;d.next().value.Visible=a;document.getElementsByName(e)[0].checked=a}updateModel()}function changeZoneVisibility(a){zoneList[a.name].Visible=a.checked;updateModel()}var transparencyOn=!0;function toggleOpacity(a){transparencyOn=a.checked;updateModel()}var windowOpacity=.3;
function updateWindowOpacity(a,c){"Enter"===a.key?(a=parseFloat(c.value),0<=a&&1>=a?(windowOpacity=a,c.value=a,matDefault.Window.opacity=windowOpacity,matDefault.Door.opacity=windowOpacity,updateModel()):c.value=windowOpacity,c.blur()):"Escape"===a.key&&(c.value=windowOpacity,c.blur())}var shadowOn=!1,selfShadow=!1;function toggleShadow(a){shadowOn=a.checked;renderer.shadowMap.enabled=shadowOn;lightShadow.castShadow=shadowOn;updateModel()}var debugOn=!1;
function toggleDebug(a){debugOn=a.checked;updateModel()}var shadingOn=!0,lineThicknessOn=!1,lineThickness=1,MAXLINETHICKNESS=5,absoluteLineThickness=NaN;
function toggleLineThickness(a){lineThicknessOn=a.checked;inputTag=[].concat($jscomp.arrayFromIterable(a.parentElement.parentElement.children)).filter(function(a){return"input"==a.tagName.toLowerCase()&&a.classList.contains("settingsInput")})[0];inputTag.disabled=!lineThicknessOn;lineThicknessOn?(inputTag.value=lineThickness,inputTag.type="number",updateAbsoluteLineThickness()):(inputTag.type="text",inputTag.value="-");updateModel()}
function updateAbsoluteLineThickness(){absoluteLineThickness=lineThickness*bldgRadius/camera.radius*1.4;matEdge2.linewidth=absoluteLineThickness}updateAbsoluteLineThickness();function updateLineThickness(a,c){"Enter"===a.key?(a=parseFloat(c.value),0<=a?(a>MAXLINETHICKNESS&&(a=MAXLINETHICKNESS),lineThickness=a,c.value=a,updateAbsoluteLineThickness(),updateModel()):c.value=lineThickness,c.blur()):"Escape"===a.key&&(c.value=lineThickness,c.blur())}
function resetSettings(){transparencyOn=!0;windowOpacity=.3;lineThicknessOn=!1;lineThickness=1;shadowOn=debugOn=!1}function updateModel(){resetScene();renderModel()}
function updateSettingsPanel(){settingsPanelContent.scrollTo(0,0);innerHTML="";innerHTML+='\n    <div class="settingsPanelBlock">\n        <h5>Visual</h5>\n\n        <label style="padding-right: 10px;"><input type="checkbox" onclick="toggleOpacity(this);" '+(transparencyOn?" checked":"")+'> Transparent materials</label>\n        <span class="settingsFlexSpan">\n            <span style="width:19px; flex:none; text-align:center; font-size:8px; line-height:8px; opacity:0.7;">\u2b24</span>\n            <span style="flex:none;">&nbsp;Window opacity :&nbsp;</span>\n            <input class="settingsInput" type="number" value="0.3" placeholder="0.3" step="any" onkeyup="updateWindowOpacity(event, this)" />\n        </span>\n        <span class="settingsFlexSpan">\n            <label style="padding-right: 10px;"><input type="checkbox" onclick="toggleLineThickness(this);" '+(lineThicknessOn?
" checked":"")+'> Edge thickness :</label>\n            <input class="settingsInput" type="text" value="'+(lineThicknessOn?lineThickness:"-")+'" placeholder="1" step="any" onkeyup="updateLineThickness(event, this)" "'+(lineThicknessOn?"":" disabled")+' />\n        </span>\n        <label style="padding-right: 10px;"><input type="checkbox" onclick="toggleShadow(this);" '+(shadowOn?" checked":"")+'> Shadow <font color="color="#8f4242"><b>(experimental)</b></font></label>\n        <label style="padding-right: 10px;"><input type="checkbox" onclick="toggleDebug(this);" '+
(debugOn?" checked":"")+"> Debug</label>\n\n    </div>\n    ";innerHTML+='\n    <div class="settingsPanelBlock">\n        <h5>Background</h5>\n\n        <center>\n            <button class="settingsPanelButton changeBackgroundColorBtn" onclick="changeBackgroundColor(0, this);">Black</button>\n            <button class="settingsPanelButton changeBackgroundColorBtn changeBgColorBtnHighlighted" onclick="changeBackgroundColor(1, this);" disabled>White</button>\n            <button class="settingsPanelButton changeBackgroundColorBtn" onclick="changeBackgroundColor(-1, this);">Transparent</button>\n        </center>\n    </div>\n    ';
innerHTML+='\n    <div class="settingsPanelBlock">\n        <h5>Zone Visibility</h5>\n\n        <center>\n            <button class="settingsPanelButton" onclick="changeZoneAll(true);">Select all</button>\n            <button class="settingsPanelButton" onclick="changeZoneAll(false);">Deselect all</button>\n        </center>\n    ';for(var a=$jscomp.makeIterator(Object.entries(zoneList)),c=a.next();!c.done;c=a.next()){c=$jscomp.makeIterator(c.value);var d=c.next().value;c.next();innerHTML+='<label><input type="checkbox" name="'+
d+'" onclick="changeZoneVisibility(this);" checked> '+d+"</label>"}innerHTML+="</div>";settingsPanelContent.innerHTML=innerHTML}function polarCoord(a,c){a=Math.radians(a);c=Math.radians(-c-90);return new THREE.Vector3(Math.cos(a)*Math.cos(c),Math.cos(a)*Math.sin(c),Math.sin(a))}var maxZoom=950,shadowOffset=[45,90],lastRendered=Date.now();
function updateCamera(a){a=void 0===a?!1:a;camera.alt=clamp(camera.alt,-90,90);camera.radius=clamp(camera.radius,1,maxZoom);lineThicknessOn&&updateAbsoluteLineThickness();camera.azm%=360;var c=camera.azm;camStepped&&(c=45*Math.round(camera.azm/45));camera.position.copy(polarCoord(camera.alt,c).multiplyScalar(camera.radius).add(camera.base));camera.lookAt(camera.base);90==Math.abs(camera.alt)&&(camera.rotation.z=Math.radians(-Math.sign(camera.alt)*c));lightDirect.position.copy(polarCoord(camera.alt,
c+45).add(camera.base));lightDirectTarget.position.copy(camera.base);lightShadow.position.copy(polarCoord(shadowOffset[0],c+shadowOffset[1]).multiplyScalar(camera.radius).add(camera.base));lightShadowTarget.position.copy(camera.base);objDev.position.copy(polarCoord(45,c+90).multiplyScalar(10).add(camera.base));c=Date.now();if(a||(c-lastRendered)/1E3>1/90)lastRendered=c,renderer.render(scene,camera),DEV&&console.log("refreshed")}
var clickable=!1,mouseLeft=!1,mouseMiddle=!1,shiftKey=!1,camStepped=!1,camFixed=!1,commandOn=!1,pressedKeys={};CanvasContainer.ondragstart=function(){return!1};
function customOnMouseMove(a){newX=a.pageX;newY=a.pageY;dX=newX-startX;dY=newY-startY;if(mouseLeft)camera.azm+=dX/panelWidth*180,camera.alt+=dY/panelHeight*180;else if(mouseMiddle){a=Math.radians(camera.alt);var c=-Math.radians(camera.azm+180),d=dX/panelWidth*camera.radius/2,e=dY/panelWidth*camera.radius/2;a=new THREE.Vector3(Math.cos(c)*d+Math.sin(a)*Math.sin(c)*e,Math.sin(c)*d-Math.sin(a)*Math.cos(c)*e,Math.cos(a)*e);camera.base.add(a)}updateCamera();startX=newX;startY=newY}
CanvasContainer.onmousedown=function(a){a=a||window.event;clickable&&(startX=a.pageX,startY=a.pageY,0==a.button&&(mouseLeft=!0,mouseMiddle=!1),1==a.button&&(mouseMiddle=!0,mouseLeft=!1),document.addEventListener("mousemove",customOnMouseMove),document.onmouseup=function(a){mouseMiddle=mouseLeft=!1;camStepped&&(camera.azm=45*Math.round(camera.azm/45));document.removeEventListener("mousemove",customOnMouseMove)})};
document.addEventListener("onmouseleave",function(){document.removeEventListener("mousemove",customOnMouseMove)});CanvasContainer.onwheel=function(a){clickable&&(camera.radius-=a.wheelDeltaY/100*clamp(Math.pow(camera.radius/50,1.2),1,Infinity),updateCamera(force=!0))};document.getElementById("PageWrapper").onwheel=function(a){a=a||window.event;if("CanvasRenderer"==a.target.id&&clickable)return!1};
document.getElementById("PageWrapper").onmousedown=function(a){a=a||window.event;if(1==a.button&&"CanvasRenderer"==a.target.id)return!1};var raycaster=new THREE.Raycaster;raycaster.layers.set(1);
var pointer=new THREE.Vector2,objectDisplay=document.getElementById("objectDisplay"),lastHighlightedObj=null,lastHighlightedObjMat=null,matHighlighted=new THREE.MeshPhongMaterial({color:"#ff0000",side:THREE.DoubleSide,opacity:.7,transparent:!0}),highlightedObjDisplayText="",lastSelectedObj=null,lastSelectedObjMat=null,matSelected=new THREE.MeshPhongMaterial({color:"#ff0000",side:THREE.DoubleSide,opacity:.8,transparent:!0}),selectedObjDisplayText="";
function objectHighlight(a){if(!mouseLeft&&!mouseMiddle){var c=a.target.getBoundingClientRect(),d=a.pageY-c.top;a=2*clamp((a.pageX-c.left)/mainPanelWidth,0,1)-1;d=2*-clamp(d/mainPanelHeight,0,1)+1;pointer.x=a;pointer.y=d;raycaster.setFromCamera(pointer,camera);d=raycaster.intersectObjects(scene.children);if((0<d.length?d[0].object:null)!==lastHighlightedObj){lastHighlightedObj&&(lastHighlightedObj.material=lastHighlightedObjMat,lastSelectedObj&&(lastSelectedObj.material=matSelected));if(0==d.length)objectDisplay.innerHTML=
"",lastHighlightedObj=null;else if(lastHighlightedObj!==(obj=d[0].object)){lastHighlightedObj=obj;lastHighlightedObjMat=obj.material.clone();obj.material=matHighlighted;selectedObjName=d=obj.sourceObjName;a=obj.sourceObjType;var e="<b>[Name]</b> "+d;switch(a){case "surface":c=surfList[d];void 0!==c.OutsideBCObj&&""!=c.OutsideBCObj&&(e+=" ("+c.OutsideBCObj.toLowerCase()+")");e+="<br><b>[Type]</b> "+a+" ("+c.SurfaceType+")";e+="<br><b>[Construction]</b> "+c.Construction;e+="<br><b>[Zone]</b> "+c.ZoneName;
e+="<br>  \u2514\u2500<b>[Surface]</b> "+d;break;case "fenestration":c=fenList[d];void 0!==c.OutsideBCObj&&""!=c.OutsideBCObj&&(e+=" ("+c.OutsideBCObj.toLowerCase()+")");e+="<br><b>[Type]</b> "+a+" ("+c.SurfaceType+")";e+="<br><b>[Construction]</b> "+c.Construction;e+="<br><b>[Zone]</b> "+surfList[c.SurfaceName].ZoneName;e+="<br>  \u2514\u2500<b>[Surface]</b> "+c.SurfaceName;e+="<br>     \u2514\u2500<b>[Fenestration]</b> "+d;break;case "shading":e+="<br><b>[Type]</b> "+a}e=e.replaceAll(" ","&nbsp;");
highlightedObjDisplayText=objectDisplay.innerHTML=e}updateCamera(force=!0)}}}CanvasRenderer.addEventListener("pointerleave",function(){null!==lastHighlightedObj&&(lastHighlightedObj.material=lastHighlightedObjMat,updateCamera(force=!0));objectDisplay.innerHTML=""});document.onkeydown=function(a){a.shiftKey&&(shiftKey=!0);mouseLeft&&a.shiftKey&&(camStepped=!0,updateCamera(force=update));"s"!=a.key||""===idfName||commandOn||"input"==a.target.tagName.toLowerCase()||exportImage();"r"==a.key&&centerCamera()};
var nonCommandKey="Shift Alt Control Enter Escape Tab CapsLock ContextMenu".split(" ");
document.onkeyup=function(a){commandOn&&!a.metaKey&&("ArrowUp"==a.key&&""!=lastCommand&&(commandListener.innerHTML=lastCommand),1==a.key.length&&(commandListener.innerHTML+=a.key.toLowerCase()));switch(a.key){case "Shift":camStepped=shiftKey=!1;updateCamera(force=!0);break;case "/":commandOn||(commandOn=!0,commandListenerVisibility(1));break;case "Enter":commandOn&&(commandOn=!1,commandListenerVisibility(0),runCommand(commandListener.innerHTML));break;case "Escape":panelVisibility(commandPanel,-1);
commandOn?(commandOn=!1,commandListenerVisibility(0)):""==idfName?settingsPanelVisibility(-1):settingsPanelVisibility(0);break;case "Backspace":commandOn&&(commandListener.innerHTML=commandListener.innerHTML.slice(0,-1))}};function resetCamera(){camera.base=new THREE.Vector3(0,0,0);camera.alt=20;camera.azm=-30;camera.radius=10;updateCamera(force=!0)}resetCamera();function centerCamera(){resetCamera();camera.base.copy(bldgCenter);camera.radius=1.5*bldgRadius;updateCamera(force=!0)}
function resetScene(){scene.remove.apply(scene,scene.children);scene.add(lightDirect);scene.add(lightDirectTarget);lightDirect.target=lightDirectTarget;scene.add(lightAmbient);scene.add(lightShadow);scene.add(lightShadowTarget);lightShadow.target=lightShadowTarget;DEV&&scene.add(objDev)}resetScene();function triangulateSurfacefromFlatVertlist(a,c){c=void 0===c?null:c;var d=[];earcut(a.flat(),c,3).forEach(function(c){d.push(a[c])});return d}
function triangulatedSurfacefromVertlist(a,c){c=void 0===c?null:c;new THREE.Vector3(1,0,0);var d=new THREE.Vector3(0,0,1),e=new THREE.Vector3,f=new (Function.prototype.bind.apply(THREE.Vector3,[null].concat($jscomp.arrayFromIterable(a[0])))),h=new (Function.prototype.bind.apply(THREE.Vector3,[null].concat($jscomp.arrayFromIterable(a[1]))));h=(new THREE.Vector3).subVectors(h,f);for(var k=2;k<a.length&&!(e=new (Function.prototype.bind.apply(THREE.Vector3,[null].concat($jscomp.arrayFromIterable(a[k])))),
e=(new THREE.Vector3).subVectors(e,f),e=(new THREE.Vector3).crossVectors(e,h),e.length()>THRESHOLD);k++);f=new THREE.BufferGeometry;e.normalize();if((new THREE.Vector3).crossVectors(e,d).length()<THRESHOLD)a=new Float32Array(triangulateSurfacefromFlatVertlist(a,c).flat()),f.setAttribute("position",new THREE.BufferAttribute(a,3));else{var l=new THREE.Quaternion;l.setFromUnitVectors(e,d);var q=[];a.forEach(function(a){vec=new (Function.prototype.bind.apply(THREE.Vector3,[null].concat($jscomp.arrayFromIterable(a))));
vec.applyQuaternion(l);q.push([vec.x,vec.y,vec.z])});a=new Float32Array(triangulateSurfacefromFlatVertlist(q,c).flat());f.setAttribute("position",new THREE.BufferAttribute(a,3));l.invert();f.applyQuaternion(l)}f.computeVertexNormals();return f}
function readFile(a){if(0<a.length){idfFile=a[0];if(idfFile.name.endsWith(".idf"))idfName=idfFile.name.slice(0,-4),idfExt=".idf";else if(idfFile.name.endsWith(".expidf"))idfName=idfFile.name.slice(0,-7),idfExt=".expidf";else{window.alert("Only .idf, .expidf formats supported!");return}reader.readAsText(idfFile,"utf-8")}}
function loadFile(a){CanvasRenderer.removeEventListener("pointermove",objectHighlight);settingsPanelVisibility(0);panelVisibility(commandPanel,0);panelVisibility(helpPanel,0);camFixed||resetSettings();lastHighlightedObjMat=lastHighlightedObj=null;parseIDF(a);fileSelectorTag.innerHTML=""==idfName?"":idfName+idfExt;updateSettingsPanel();addModel();CanvasRenderer.addEventListener("pointermove",objectHighlight)}var reader=new FileReader;reader.onload=function(){loadFile(reader.result)};
var fileSelector=document.getElementById("fileSelector"),fileSelectorTag=document.getElementById("fileSelectorTag");fileSelector.addEventListener("change",function(a){readFile(a.target.files)});document.body.addEventListener("drop",function(a){a.stopPropagation();a.preventDefault();clickable=!0;fileHoverMask.style.display="none";fileHover.style.display="none";readFile(a.dataTransfer.files)});
var fileHoverMask=document.getElementById("fileHoverMask"),fileHover=document.getElementById("fileHover"),fileHoverText=document.getElementById("fileHoverText");
document.body.addEventListener("dragover",function(a){a.stopPropagation();a.preventDefault();a.dataTransfer.dropEffect="copy";clickable=!1;fileHoverMask.style.display="block";fileHover.style.display="block";a.shiftKey?(camFixed=!0,fileHoverText.style.textShadow="#fff 0 0 10px, #ffe880 0 0 20px, #000 0 0 30px"):(camFixed=!1,fileHoverText.style.textShadow="#fff 0 0 10px, #80daff 0 0 20px, #000 0 0 30px")});
fileHoverMask.addEventListener("dragleave",function(a){camFixed=!1;clickable=!0;fileHoverMask.style.display="none";fileHover.style.display="none"});
function parseIDF(a){northAxis=0;boundary=[[Infinity,Infinity,Infinity],[-Infinity,-Infinity,-Infinity]];bldgRadius=0;bldgCenter=new THREE.Vector3;zoneList={};constList=[];surfList={};fenList={};shadeList={};geometryList={Opaque:[],Transparent:[],Edge:[]};shadowCatcher=null;if(0>=a.length)return-1;a=a.replace(/!.*\s*/g,"");a=a.replace(/,\s*/g,",").replace(/;\s*/g,";").trim();a=a.split(";");iddInfo=iddInfoLibrary=null;for(var c=0;c<a.length;c++){var d=a[c];if(d.toLowerCase().startsWith("version")){d=
d.split(",")[1].split(".");console.log(d);v=[parseInt(d[0]),parseInt(d[1])];versionCode=v[0]+"_"+v[1]+"_0";versionCode in versionLibrary||(versionCode=7>=v[0]?"7_2_0":Object.keys(versionLibrary)[Object.keys(versionLibrary).length-1]);console.log(versionCode+".idd used.");break}}iddInfoLibrary=versionLibrary[versionCode];console.log(iddInfoLibrary);for(c=0;c<a.length;c++)if(d=a[c],d.toLowerCase().startsWith("building")){northAxis=parseFloat(d.split(",")[2]);break}a.forEach(function(a){if(a.toLowerCase().startsWith("zone")||
a.toLowerCase().startsWith("construction")){a=a.split(",");var c=a[1];switch(a[0].toLowerCase()){case "zone":iddInfo=iddInfoLibrary.zone;c in zoneList||(zoneList[c]={Surfaces:[],Origin:[Number(a[iddInfo.indexOf("x origin")]),Number(a[iddInfo.indexOf("y origin")]),Number(a[iddInfo.indexOf("z origin")])],NDirection:[],Visible:!0});break;case "construction":constList.push(c)}}});alerted=!1;a.forEach(function(a){if(a.toLowerCase().startsWith("wall,")||a.toLowerCase().startsWith("wall:")||a.toLowerCase().startsWith("window,")||
a.toLowerCase().startsWith("window:"))alerted||(alerted=!0,idfName="",settingsPanelVisibility(-1),window.alert('Currently only supports idf files using "BuildingSurface:Detailed".'));else if(a.toLowerCase().startsWith("buildingsurface:detailed")||a.toLowerCase().startsWith("fenestrationsurface:detailed")||a.toLowerCase().startsWith("shading:building:detailed")){a=a.split(",");var c=a[1].toLowerCase();switch(a[0].toLowerCase()){case "buildingsurface:detailed":iddInfo=iddInfoLibrary["buildingsurface:detailed"];
zoneName=a[iddInfo.indexOf("zone name")];zoneCoord=zoneList[zoneName].Origin;for(var d=iddInfo.indexOf("vertex 1 x-coordinate"),e=parseInt((a.length-d)/3),l=[],q=-Infinity,p=0;p<e;p++){for(var t=[],m=0;3>m;m++){coordRelative=Number(a[d+3*p+m]);var n=zoneCoord[m]+coordRelative;n<boundary[0][m]&&(boundary[0][m]=n);n>boundary[1][m]&&(boundary[1][m]=n);t.push(n);2==m&&q<n&&(q=n)}l.push(t)}d=[];c in surfList&&(d=surfList[c].Fenestrations);surfList[c]={SurfaceType:a[iddInfo.indexOf("surface type")].toLowerCase(),
Construction:a[iddInfo.indexOf("construction name")],ZoneName:zoneName,OutsideBC:a[iddInfo.indexOf("outside boundary condition")].toLowerCase(),OutsideBCObj:a[iddInfo.indexOf("outside boundary condition object")],VerticeNumber:e,Vertices:l,Fenestrations:d,MaximumZ:q};zoneList[zoneName].Surfaces.push(c);break;case "fenestrationsurface:detailed":iddInfo=iddInfoLibrary["fenestrationsurface:detailed"];surfName=a[iddInfo.indexOf("building surface name")].toLowerCase();zoneName=surfList[surfName].ZoneName;
zoneCoord=zoneList[zoneName].Origin;d=iddInfo.indexOf("vertex 1 x-coordinate");e=parseInt((a.length-d)/3);l=[];for(p=0;p<e;p++){t=[];for(m=0;3>m;m++)coordRelative=Number(a[d+3*p+m]),n=zoneCoord[m]+coordRelative,n<boundary[0][m]&&(boundary[0][m]=n),n>boundary[1][m]&&(boundary[1][m]=n),t.push(n);l.push(t)}fenList[c]={SurfaceType:a[iddInfo.indexOf("surface type")].toLowerCase(),Construction:a[iddInfo.indexOf("construction name")],SurfaceName:surfName,OutsideBCObj:a[iddInfo.indexOf("outside boundary condition object")],
VerticeNumber:e,Vertices:l};surfName in surfList?surfList[surfName].Fenestrations.push(c):surfList[surfName]={Fenestrations:[c]};break;case "shading:building:detailed":iddInfo=iddInfoLibrary["shading:building:detailed"];d=iddInfo.indexOf("vertex 1 x-coordinate");e=parseInt((a.length-d)/3);l=[];q=-Infinity;for(p=0;p<e;p++){t=[];for(m=0;3>m;m++)n=Number(a[d+3*p+m]),n<boundary[0][m]&&(boundary[0][m]=n),n>boundary[1][m]&&(boundary[1][m]=n),t.push(n),2==m&&q<n&&(q=n);l.push(t)}shadeList[c]={VerticeNumber:e,
Vertices:l}}}});a=[];for(axis=d=0;3>axis;axis++)a.push((boundary[0][axis]+boundary[1][axis])/2),d+=Math.pow(boundary[1][axis]-boundary[0][axis],2);bldgRadius=Math.sqrt(d);bldgCenter=new THREE.Vector3(a[0],a[1],a[2]);console.log(constList);console.log(surfList);console.log(fenList);console.log("Done!")}
function addModel(){resetScene();camFixed||centerCamera();minZ=-.01;shadCatPadX=boundary[1][0]-boundary[0][0];shadCatPadY=boundary[1][1]-boundary[0][1];shadCatPad=Math.max(shadCatPadX,shadCatPadY);var a=new THREE.BufferGeometry;shadowCatcherVerts=new Float32Array([boundary[0][0]-shadCatPadX,boundary[0][1]-shadCatPadY,minZ,boundary[1][0]+shadCatPadX,boundary[0][1]-shadCatPadY,minZ,boundary[1][0]+shadCatPadX,boundary[1][1]+shadCatPadY,minZ,boundary[0][0]-shadCatPadX,boundary[0][1]-shadCatPadY,minZ,
boundary[1][0]+shadCatPadX,boundary[1][1]+shadCatPadY,minZ,boundary[0][0]-shadCatPadX,boundary[1][1]+shadCatPadY,minZ]);a.setAttribute("position",new THREE.BufferAttribute(shadowCatcherVerts,3));a.computeVertexNormals();shadowCatcher=new THREE.Mesh(a,shadowCatcherMat);shadowCatcher.receiveShadow=!0;shadowCatcher.renderOrder=Infinity;shadowCatcher.translateZ(boundary[0][2]);lightShadow.shadow.camera=new THREE.OrthographicCamera(-shadCatPad,shadCatPad,shadCatPad,-shadCatPad,.5,1E3);a=new THREE.Vector3(boundary[0][0]-
.1*bldgRadius,boundary[0][1]-.1*bldgRadius,0);axisXObject=axisXObjTemplate.clone();axisXObject.translateX(a.x);axisXObject.translateY(a.y);axisYObject=axisYObjTemplate.clone();axisYObject.translateX(a.x);axisYObject.translateY(a.y);axisZObject=axisZObjTemplate.clone();axisZObject.translateX(a.x);axisZObject.translateY(a.y);axisTrueNorthObject=axisTrueNorthObjTemplate.clone();axisTrueNorthObject.translateX(a.x);axisTrueNorthObject.translateY(a.y);axisTrueNorthObject.rotateZ(Math.radians(northAxis));
a=$jscomp.makeIterator(Object.entries(surfList));for(var c=a.next();!c.done;c=a.next()){var d=$jscomp.makeIterator(c.value);c=d.next().value;var e=d.next().value,f=e.Vertices;if(0<e.Fenestrations.length){var h=[];e.Fenestrations.forEach(function(a){fen=fenList[a];h.push(f.length);f=f.concat(fen.Vertices)})}else h=null;d=triangulatedSurfacefromVertlist(f,h);surfList[c].Geometries=d;var k=[],l=[];e.Vertices.forEach(function(a){k.push(new THREE.Vector3(a[0],a[1],a[2]));l.push.apply(l,$jscomp.arrayFromIterable(a))});
k.push(k[0]);l.push(l[0],l[1],l[2]);d=(new THREE.BufferGeometry).setFromPoints(k);surfList[c].EdgeObjects=new THREE.Line(d,matEdge);d=new LineGeometry;d.setPositions(l);surfList[c].EdgeObjects2=new Line2(d,matEdge2);surfList[c].EdgeObjects2.renderOrder=0;surfList[c].MaximumZ>boundary[0][2]?(d=triangulatedSurfacefromVertlist(e.Vertices),d=new THREE.Mesh(d,matGhost),d.castShadow=!0,d.material.colorWrite=!1,d.renderOrder=Infinity,surfList[c].ShadowObjects=d):surfList[c].ShadowObjects=null}a=$jscomp.makeIterator(Object.entries(fenList));
for(c=a.next();!c.done;c=a.next())d=$jscomp.makeIterator(c.value),c=d.next().value,d=d.next().value,e=triangulatedSurfacefromVertlist(d.Vertices),e.computeVertexNormals(),fenList[c].Geometries=e,k=[],l=[],d.Vertices.forEach(function(a){k.push(new THREE.Vector3(a[0],a[1],a[2]));l.push.apply(l,$jscomp.arrayFromIterable(a))}),k.push(k[0]),l.push(l[0],l[1],l[2]),d=(new THREE.BufferGeometry).setFromPoints(k),fenList[c].EdgeObjects=new THREE.Line(d,matEdge),d=new LineGeometry,d.setPositions(l),fenList[c].EdgeObjects2=
new Line2(d,matEdge2),fenList[c].EdgeObjects2.renderOrder=0;a=$jscomp.makeIterator(Object.entries(shadeList));for(c=a.next();!c.done;c=a.next())d=$jscomp.makeIterator(c.value),c=d.next().value,d=d.next().value,e=triangulatedSurfacefromVertlist(d.Vertices),e.computeVertexNormals(),shadeList[c].Geometries=e,k=[],d.Vertices.forEach(function(a){k.push(new THREE.Vector3(a[0],a[1],a[2]))}),k.push(k[0]),d=(new THREE.BufferGeometry).setFromPoints(k),shadeList[c].EdgeObjects=new THREE.Line(d,matEdge);renderModel()}
function rgbToHex(a){r=parseInt(255*a.r);g=parseInt(255*a.g);b=parseInt(255*a.b);hex=(16777216+(r<<16)+(g<<8)+b).toString(16).slice(1);return"#"+hex}function hexToRgb(a){hex=a.slice(1);hex=hex.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(a,d,e,f){return d+d+e+e+f+f});return(a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex))?{r:parseInt(a[1],16)/255,g:parseInt(a[2],16)/255,b:parseInt(a[3],16)/255}:null}
function add_white_color_rgb(a,c){c=void 0===c?.5:c;h_str="string"==typeof a?a:rgbToHex(a);rgb=hexToRgb(h_str);return Object.fromEntries(Object.entries(rgb).map(function(a){var d=$jscomp.makeIterator(a);a=d.next().value;d=d.next().value;return[a,d*c+(1-c)]}))}function add_white_color_hex(a,c){return rgbToHex(add_white_color_rgb(a,void 0===c?.5:c))}
function add_black_color_rgb(a,c){c=void 0===c?.5:c;h_str="string"==typeof a?a:rgbToHex(a);rgb=hexToRgb(h_str);return Object.fromEntries(Object.entries(rgb).map(function(a){var d=$jscomp.makeIterator(a);a=d.next().value;d=d.next().value;return[a,d*c]}))}function add_black_color_hex(a,c){return rgbToHex(add_black_color_rgb(a,void 0===c?.5:c))}
var matDefault={Adiabatic:new THREE.MeshPhongMaterial({color:"#f24b91",side:THREE.DoubleSide,opacity:.8}),Roof:new THREE.MeshPhongMaterial({color:add_black_color_hex("#a82525",alpha=.7),side:THREE.DoubleSide,opacity:.85}),OuterWall:new THREE.MeshLambertMaterial({color:"#ffe16b",side:THREE.DoubleSide}),InnerSurf:new THREE.MeshPhongMaterial({color:"#444444",side:THREE.DoubleSide,opacity:.5}),OuterSurf:new THREE.MeshPhongMaterial({color:"#444444",side:THREE.DoubleSide,opacity:.8}),Window:new THREE.MeshPhongMaterial({color:"#47dcff",
side:THREE.DoubleSide,opacity:.3}),Door:new THREE.MeshPhongMaterial({color:"#1747d4",side:THREE.DoubleSide,opacity:.3}),Shading:new THREE.MeshPhongMaterial({color:"#624285",side:THREE.DoubleSide,opacity:.7}),Ground:new THREE.MeshLambertMaterial({color:"#555555",side:THREE.DoubleSide}),Disabled:new THREE.MeshPhongMaterial({color:"#bbbbbb",side:THREE.DoubleSide,opacity:.3})},mat;for(mat in matDefault)1>matDefault[mat].opacity&&(matDefault[mat].transparent=!0);
function renderModel(){shadowOn&&scene.add(shadowCatcher);for(var a=[],c=$jscomp.makeIterator(Object.entries(surfList)),d=c.next();!d.done;d=c.next()){var e=$jscomp.makeIterator(d.value);d=e.next().value;e=e.next().value;if(!a.includes(d)){zoneName=e.ZoneName;surfGeom=e.Geometries;var f=matDefault.InnerSurf;switch(e.OutsideBC){case "outdoors":switch(e.SurfaceType){case "wall":f=matDefault.OuterWall;break;case "roof":f=matDefault.Roof;break;case "floor":f=matDefault.OuterSurf}break;case "adiabatic":f=
matDefault.Adiabatic;break;case "ground":f=matDefault.Ground}d.toLowerCase()==e.OutsideBCObj.toLowerCase()&&(f=matDefault.Adiabatic);f=f.clone();if(""!=e.OutsideBCObj){var h=e.OutsideBCObj.toLowerCase(),k=surfList[h].ZoneName;if(zoneList[zoneName].Visible)a.push(h);else if(zoneList[k].Visible){a.push(d);continue}else a.push(h)}zoneList[zoneName].Visible?(transparencyOn||(1>f.opacity&&(f.color=add_white_color_rgb(add_black_color_hex(f.color,f.opacity),1-(1-f.opacity)/2.5),f.opacity=1),f.transparent=
!1),f=new THREE.Mesh(surfGeom,f),f.renderOrder=1,f.layers.enable(1),f.sourceObjName=d,f.sourceObjType="surface",selfShadow&&(f.receiveShadow=!0),scene.add(f),lineThicknessOn&&["outdoors","ground"].includes(e.OutsideBC)?scene.add(e.EdgeObjects2):scene.add(e.EdgeObjects),shadowOn&&null!=e.ShadowObjects&&scene.add(e.ShadowObjects)):(d=new THREE.Mesh(surfGeom,matDefault.Disabled),d.renderOrder=2,d.layers.enable(2),scene.add(d))}}a=[];c=$jscomp.makeIterator(Object.entries(fenList));for(d=c.next();!d.done;d=
c.next())if(e=$jscomp.makeIterator(d.value),d=e.next().value,e=e.next().value,!a.includes(d)&&(f=surfList[e.SurfaceName],zoneName=f.ZoneName,zoneList[zoneName].Visible)){""!=e.OutsideBCObj&&a.push(e.OutsideBCObj.toLowerCase());fenGeom=e.Geometries;h=matDefault.Window;switch(e.SurfaceType){case "door":h=matDefault.Door}h=h.clone();h.color=add_white_color_rgb(add_black_color_hex(h.color,clamp(1.3-windowOpacity,0,1)),1-clamp(windowOpacity-.3,0,1)/2.5);h=new THREE.Mesh(fenGeom,h);h.layers.enable(1);h.sourceObjName=
d;h.sourceObjType="fenestration";scene.add(h);lineThicknessOn&&["outdoors","ground"].includes(f.OutsideBC)?scene.add(e.EdgeObjects2):scene.add(e.EdgeObjects)}if(shadingOn)for(a=$jscomp.makeIterator(Object.entries(shadeList)),c=a.next();!c.done;c=a.next()){d=$jscomp.makeIterator(c.value);c=d.next().value;d=d.next().value;shadeGeom=d.Geometries;e=matDefault.Shading;switch(d.SurfaceType){case "door":e=matDefault.Door}e=e.clone();transparencyOn||(1>e.opacity&&(e.color=add_white_color_rgb(add_black_color_hex(e.color,
e.opacity),1-(1-e.opacity)/2.2),e.opacity=1),e.transparent=!1);e=new THREE.Mesh(shadeGeom,e);e.layers.enable(1);e.sourceObjName=c;e.sourceObjType="shading";scene.add(e);scene.add(d.EdgeObjects)}debugOn&&(scene.add(axisXObject),scene.add(axisYObject),scene.add(axisZObject),scene.add(axisTrueNorthObject));updateCamera(force=!0)}
function changeBackgroundColor(a,c){a=void 0===a?-1:a;c=void 0===c?null:c;Array.from(document.getElementsByClassName("changeBackgroundColorBtn")).forEach(function(a){a.classList.remove("changeBgColorBtnHighlighted");a.disabled=!1});c.classList.add("changeBgColorBtnHighlighted");c.disabled=!0;switch(a){case -1:CanvasContainer.style.backgroundColor="";objectDisplay.className="transparentmode";console.log('Background changed to "transparent"');break;case 0:CanvasContainer.style.backgroundColor="black";
objectDisplay.className="blackmode";console.log('Background changed to "black"');break;case 1:CanvasContainer.style.backgroundColor="white",objectDisplay.className="whitemode",console.log('Background changed to "white"')}}var commandListener=document.getElementById("CommandListener");commandListenerVisibility(0);
function commandListenerVisibility(a){switch(void 0===a?0:a){case 0:commandListener.style.visibility="hidden";commandListener.style.opacity=0;commandListener.classList.remove("fadein");commandListener.classList.add("fadeout");break;case 1:commandListener.innerHTML="",commandListener.style.visibility="visible",commandListener.style.opacity=1,commandListener.classList.remove("fadeout"),commandListener.classList.add("fadein"),commandListener.classList.remove("CommandFail"),commandListener.classList.remove("CommandSuccess")}}
var lastCommand="";
function runCommand(a){lastCommand=a=void 0===a?"":a;commandListener.classList.add("CommandSuccess");switch(a){case "test":console.log("TEST!");break;case "help":panelVisibility(commandPanel,1);break;default:if(a.includes(" ")){log=a.match(/(\S+)\s+(\S+)/);a=log[1];var c=log[2];lastCommand=a;switch(a){case "test":console.log("TEST! -",c);break;case "camerafar":c=parseFloat(c);1E3>c&&(c=1E3);camera.far=c;camera.updateProjectionMatrix();updateCamera(force=!0);break;case "maxzoom":c=parseFloat(c);950>
c&&(c=950);maxZoom=c;camera.far=c+50;camera.updateProjectionMatrix();updateCamera(force=!0);break;case "shadowalt":c=parseFloat(c);shadowOffset[0]=c;updateCamera(force=!0);break;case "shadowazm":c=parseFloat(c);shadowOffset[1]=c;updateCamera(force=!0);break;case "shadowmapsize":c=parseInt(c);lightShadow.shadow.mapSize.width=c;lightShadow.shadow.mapSize.height=c;lightShadow.shadow.map.dispose();lightShadow.shadow.map=null;updateCamera(force=!0);break;case "shadowradius":c=parseFloat(c);lightShadow.shadow.radius=
c;lightShadow.shadow.map.dispose();lightShadow.shadow.map=null;updateCamera(force=!0);break;case "shadowheight":c=parseFloat(c);shadowCatcher.translateZ(c-shadowCatcher.position.z);updateCamera(force=!0);break;case "selfshadow":"on"==c?(selfShadow=!0,lightShadow.shadow.normalBias=-.1):(selfShadow=!1,lightShadow.shadow.normalBias=0);updateModel();break;default:lastCommand="",commandListener.classList.remove("CommandSuccess"),commandListener.classList.add("CommandFail")}}else lastCommand="",commandListener.classList.remove("CommandSuccess"),
commandListener.classList.add("CommandFail")}};
