var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};
$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(a,b){this.$jscomp$symbol$id_=a;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:b})};
$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function a(c){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(c||"")+"_"+b++,c)}var b=0;return a}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};
$jscomp.polyfill("Object.fromEntries",function(a){return a?a:function(a){var b={};$jscomp.initSymbolIterator();if(!(Symbol.iterator in a))throw new TypeError(""+a+" is not iterable");a=a[Symbol.iterator].call(a);for(var d=a.next();!d.done;d=a.next()){d=d.value;if(Object(d)!==d)throw new TypeError("iterable for fromEntries should yield objects");b[d[0]]=d[1]}return b}},"es_2019","es3");$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};
$jscomp.polyfill("Object.entries",function(a){return a?a:function(a){var b=[],d;for(d in a)$jscomp.owns(a,d)&&b.push([d,a[d]]);return b}},"es8","es3");$jscomp.polyfill("Object.values",function(a){return a?a:function(a){var b=[],d;for(d in a)$jscomp.owns(a,d)&&b.push(a[d]);return b}},"es8","es3");$jscomp.polyfill("Object.is",function(a){return a?a:function(a,c){return a===c?0!==a||1/a===1/c:a!==a&&c!==c}},"es6","es3");
$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(a,c){var b=this;b instanceof String&&(b=String(b));var e=b.length;c=c||0;for(0>c&&(c=Math.max(c+e,0));c<e;c++){var g=b[c];if(g===a||Object.is(g,a))return!0}return!1}},"es7","es3");
$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(a,c){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,c||0)}},"es6","es3");
$jscomp.polyfill("Array.from",function(a){return a?a:function(a,c,d){c=null!=c?c:function(a){return a};var b=[],g="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];if("function"==typeof g){a=g.call(a);for(var f=0;!(g=a.next()).done;)b.push(c.call(d,g.value,f++))}else for(g=a.length,f=0;f<g;f++)b.push(c.call(d,a[f],f));return b}},"es6","es3");$jscomp.polyfill("Math.sign",function(a){return a?a:function(a){a=Number(a);return 0===a||isNaN(a)?a:0<a?1:-1}},"es6","es3");
$jscomp.polyfill("Array.prototype.flat",function(a){return a?a:function(a){a=void 0===a?1:a;for(var b=[],d=0;d<this.length;d++){var e=this[d];Array.isArray(e)&&0<a?(e=Array.prototype.flat.call(e,a-1),b.push.apply(b,e)):b.push(e)}return b}},"es9","es5");
$jscomp.polyfill("String.prototype.endsWith",function(a){return a?a:function(a,c){var b=$jscomp.checkStringArgs(this,a,"endsWith");a+="";void 0===c&&(c=b.length);c=Math.max(0,Math.min(c|0,b.length));for(var e=a.length;0<e&&0<c;)if(b[--c]!=a[--e])return!1;return 0>=e}},"es6","es3");
$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(a,c){var b=$jscomp.checkStringArgs(this,a,"startsWith");a+="";var e=b.length,g=a.length;c=Math.max(0,Math.min(c|0,b.length));for(var f=0;f<g&&c<e;)if(b[c++]!=a[f++])return!1;return f>=g}},"es6","es3");
$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var c=0,d={next:function(){if(c<a.length){var e=c++;return{value:b(e,a[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
$jscomp.polyfill("Math.log10",function(a){return a?a:function(a){return Math.log(a)/Math.LN10}},"es6","es3");$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(a){function b(){this.batch_=null}function c(a){return a instanceof e?a:new e(function(b,c){b(a)})}if(a&&!$jscomp.FORCE_POLYFILL_PROMISE)return a;b.prototype.asyncExecute=function(a){if(null==this.batch_){this.batch_=[];var b=this;this.asyncExecuteFunction(function(){b.executeBatch_()})}this.batch_.push(a)};var d=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(a){d(a,0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=
this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var c=a[b];a[b]=null;try{c()}catch(l){this.asyncThrow_(l)}}}this.batch_=null};b.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var e=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(k){b.reject(k)}};e.prototype.createResolveAndReject_=function(){function a(a){return function(d){c||(c=!0,a.call(b,d))}}var b=this,c=!1;
return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};e.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof e)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var b=null!=a;break a;case "function":b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};e.prototype.resolveToNonPromiseObj_=function(a){var b=void 0;try{b=a.then}catch(k){this.reject_(k);return}"function"==typeof b?
this.settleSameAsThenable_(b,a):this.fulfill_(a)};e.prototype.reject_=function(a){this.settle_(2,a)};e.prototype.fulfill_=function(a){this.settle_(1,a)};e.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b+"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};e.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=0;a<this.onSettledCallbacks_.length;++a)g.asyncExecute(this.onSettledCallbacks_[a]);
this.onSettledCallbacks_=null}};var g=new b;e.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};e.prototype.settleSameAsThenable_=function(a,b){var c=this.createResolveAndReject_();try{a.call(b,c.resolve,c.reject)}catch(l){c.reject(l)}};e.prototype.then=function(a,b){function c(a,b){return"function"==typeof a?function(b){try{d(a(b))}catch(v){f(v)}}:b}var d,f,g=new e(function(a,b){d=a;f=b});this.callWhenSettled_(c(a,d),c(b,f));return g};
e.prototype.catch=function(a){return this.then(void 0,a)};e.prototype.callWhenSettled_=function(a,b){function c(){switch(d.state_){case 1:a(d.result_);break;case 2:b(d.result_);break;default:throw Error("Unexpected state: "+d.state_);}}var d=this;null==this.onSettledCallbacks_?g.asyncExecute(c):this.onSettledCallbacks_.push(c)};e.resolve=c;e.reject=function(a){return new e(function(b,c){c(a)})};e.race=function(a){return new e(function(b,d){for(var e=$jscomp.makeIterator(a),f=e.next();!f.done;f=e.next())c(f.value).callWhenSettled_(b,
d)})};e.all=function(a){var b=$jscomp.makeIterator(a),d=b.next();return d.done?c([]):new e(function(a,e){function f(b){return function(c){g[b]=c;l--;0==l&&a(g)}}var g=[],l=0;do g.push(void 0),l++,c(d.value).callWhenSettled_(f(g.length-1),e),d=b.next();while(!d.done)})};return e},"es6","es3");
$jscomp.polyfill("String.prototype.repeat",function(a){return a?a:function(a){var b=$jscomp.checkStringArgs(this,null,"repeat");if(0>a||1342177279<a)throw new RangeError("Invalid count value");a|=0;for(var d="";a;)if(a&1&&(d+=b),a>>>=1)b+=b;return d}},"es6","es3");$jscomp.stringPadding=function(a,b){a=void 0!==a?String(a):" ";return 0<b&&a?a.repeat(Math.ceil(b/a.length)).substring(0,b):""};
$jscomp.polyfill("String.prototype.padStart",function(a){return a?a:function(a,c){var b=$jscomp.checkStringArgs(this,null,"padStart");return $jscomp.stringPadding(c,a-b.length)+b}},"es8","es3");Math.radians=function(a){return a*Math.PI/180};Math.degrees=function(a){return 180*a/Math.PI};var clamp=function(a,b,c){return Math.min(Math.max(a,b),c)},roundFloat=function(a,b){return Math.round(a*Math.pow(10,b))/Math.pow(10,b)},THRESHOLD=1E-4,REFRESHRATE=1/65;
function rgbToHex(a){var b=parseInt(255*a.r),c=parseInt(255*a.g);a=parseInt(255*a.b);return"#"+(16777216+(b<<16)+(c<<8)+a).toString(16).slice(1)}function hexToRgb(a){a=a.slice(1);a=a.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(a,c,d,e){return c+c+d+d+e+e});return(a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a))?{r:parseInt(a[1],16)/255,g:parseInt(a[2],16)/255,b:parseInt(a[3],16)/255}:null}
function add_white_color_rgb(a,b){b=void 0===b?.5:b;a="string"==typeof a?a:rgbToHex(a);a=hexToRgb(a);return Object.fromEntries(Object.entries(a).map(function(a){var c=$jscomp.makeIterator(a);a=c.next().value;c=c.next().value;return[a,c*b+(1-b)]}))}function add_white_color_hex(a,b){return rgbToHex(add_white_color_rgb(a,void 0===b?.5:b))}
function add_black_color_rgb(a,b){b=void 0===b?.5:b;a="string"==typeof a?a:rgbToHex(a);a=hexToRgb(a);return Object.fromEntries(Object.entries(a).map(function(a){var c=$jscomp.makeIterator(a);a=c.next().value;c=c.next().value;return[a,c*b]}))}function add_black_color_hex(a,b){return rgbToHex(add_black_color_rgb(a,void 0===b?.5:b))}
DEFAULTS={shadingOn:!0,debugOn:!1,lineThicknessOn:!1,lineThickness:1,hiddenMatType:"ghost",transparencyOn:!0,materialBy:"byType",overrideMatOn:!1,matSettings:{common:{side:THREE.DoubleSide,transparent:!0,alphaTest:.01},templates:{DefaultOpaque:{color:"#f5f5f5",opacity:1},DefaultTransparent:{color:"#f5f5f5",opacity:.5},Opaque:{color:"#f72568",opacity:1},Transparent:{color:"#f72568",opacity:.7},Shading:{color:"#f5f5f5",opacity:.8}},byType:{Adiabatic:{color:"#f24b91",opacity:.8},Override:{color:"#f5f5f5",
opacity:1},Roof:{color:add_black_color_hex("#a82525",.7),opacity:.85},OuterWall:{color:"#ffe16b",opacity:1},InnerSurf:{color:"#444444",opacity:.5},OuterSurf:{color:"#444444",opacity:.8},Window:{color:"#47dcff",opacity:.3},Door:{color:"#1747d4",opacity:.3},Shading:{color:"#624285",opacity:.7},Ground:{color:"#555555",opacity:1}},byConst:{}},matTemplates:{Disabled:new THREE.MeshPhongMaterial({color:"#bbbbbb",opacity:.2,side:THREE.DoubleSide,transparent:!0})},visFilterType:"zones",shadowOn:!1,selfShadow:!1,
shadowRadius:1,shadowMapSize:1024,shadowOffset:[45,90],sceneObjectKeys:["surfMesh"]};
var readSuccess=!1,idfName="",idfExt="",iddInfoLibrary=null,northAxis=0,boundary=[],bldgRadius=0,bldgCenter=new THREE.Vector3,zoneList=[],surfList={},fenList={},shadeList={},sceneObjects=Object.fromEntries(DEFAULTS.sceneObjectKeys.map(function(a){return[a,[]]})),shadowCatcher=null,matEdge=new THREE.LineBasicMaterial({color:0,linewidth:1}),matEdge2=new LineMaterial({color:"#000000",linewidth:1,alphaToCoverage:!1}),axisLength=10,axisXObjTemplate=new THREE.Line((new THREE.BufferGeometry).setFromPoints([new THREE.Vector3(0,
0,0),new THREE.Vector3(axisLength,0,0)]),new THREE.LineBasicMaterial({color:16711680})),axisYObjTemplate=new THREE.Line((new THREE.BufferGeometry).setFromPoints([new THREE.Vector3(0,0,0),new THREE.Vector3(0,axisLength,0)]),new THREE.LineBasicMaterial({color:65280})),axisZObjTemplate=new THREE.Line((new THREE.BufferGeometry).setFromPoints([new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,axisLength)]),new THREE.LineBasicMaterial({color:255})),axisTrueNorthObjTemplate=new THREE.Line((new THREE.BufferGeometry).setFromPoints([new THREE.Vector3(0,
0,0),new THREE.Vector3(0,axisLength,0)]),new THREE.LineDashedMaterial({color:65280,linewidth:2,dashSize:1.5,gapSize:1}));axisTrueNorthObjTemplate.computeLineDistances();var axisXObject=null,axisYObject=null,axisZObject=null,axisTrueNorthObject=null,shadowCatcherMat=new THREE.ShadowMaterial;shadowCatcherMat.opacity=.5;
for(var matGhost=new THREE.MeshBasicMaterial(Object.assign({},{color:0,blending:THREE.AdditiveBlending},DEFAULTS.matSettings.common)),matSettings={byType:structuredClone(DEFAULTS.matSettings.byType),byConst:{},byConstDefault:{}},materials={byType:{Adiabatic:new THREE.MeshPhongMaterial(DEFAULTS.matSettings.byType.Adiabatic),Override:new THREE.MeshPhongMaterial(DEFAULTS.matSettings.byType.Override),Roof:new THREE.MeshPhongMaterial(DEFAULTS.matSettings.byType.Roof),OuterWall:new THREE.MeshLambertMaterial(DEFAULTS.matSettings.byType.OuterWall),
InnerSurf:new THREE.MeshPhongMaterial(DEFAULTS.matSettings.byType.InnerSurf),OuterSurf:new THREE.MeshPhongMaterial(DEFAULTS.matSettings.byType.OuterSurf),Window:new THREE.MeshPhongMaterial(DEFAULTS.matSettings.byType.Window),Door:new THREE.MeshPhongMaterial(DEFAULTS.matSettings.byType.Door),Shading:new THREE.MeshPhongMaterial(DEFAULTS.matSettings.byType.Shading),Ground:new THREE.MeshLambertMaterial(DEFAULTS.matSettings.byType.Ground)},byConst:{},byConstDefault:{}},$jscomp$iter$2=$jscomp.makeIterator(Object.values(materials)),
$jscomp$key$matGroup=$jscomp$iter$2.next();!$jscomp$key$matGroup.done;$jscomp$key$matGroup=$jscomp$iter$2.next())for(var matGroup=$jscomp$key$matGroup.value,$jscomp$iter$1=$jscomp.makeIterator(Object.values(matGroup)),$jscomp$key$mat=$jscomp$iter$1.next();!$jscomp$key$mat.done;$jscomp$key$mat=$jscomp$iter$1.next())for(var mat=$jscomp$key$mat.value,$jscomp$iter$0=$jscomp.makeIterator(Object.entries(DEFAULTS.matSettings.common)),$jscomp$key$$jscomp$destructuring$var4=$jscomp$iter$0.next();!$jscomp$key$$jscomp$destructuring$var4.done;$jscomp$key$$jscomp$destructuring$var4=
$jscomp$iter$0.next()){var $jscomp$destructuring$var4=$jscomp$key$$jscomp$destructuring$var4.value,$jscomp$destructuring$var5=$jscomp.makeIterator($jscomp$destructuring$var4),key=$jscomp$destructuring$var5.next().value,prop=$jscomp$destructuring$var5.next().value;if("transparent"!=key||1!=mat.opacity)mat[key]=prop}var scene=new THREE.Scene;scene.background=null;var camera=new THREE.PerspectiveCamera(30,canvWidth/canvHeight,.1,1E3);camera.up=new THREE.Vector3(0,0,1);
var lightDirect=new THREE.DirectionalLight(15658734,.6),lightDirectTarget=new THREE.Object3D,lightAmbient=new THREE.AmbientLight(8947848,1),lightShadow=new THREE.DirectionalLight(15658734,0),shadowRadius=DEFAULTS.shadowRadius;lightShadow.shadow.radius=shadowRadius;var shadowOffset=DEFAULTS.shadowOffset,shadowMapSize=DEFAULTS.shadowMapSize;lightShadow.shadow.mapSize.width=shadowMapSize;lightShadow.shadow.mapSize.height=shadowMapSize;
var lightShadowTarget=new THREE.Object3D,DEV=!1,matDev=new THREE.MeshPhongMaterial({color:16776960}),geomDev=new THREE.SphereGeometry(3,8,4),objDev=new THREE.Mesh(geomDev,matDev),renderer=new THREE.WebGLRenderer({alpha:!0,antialias:!0,preserveDrawingBuffer:!0});renderer.setClearColor(16777215,0);renderer.setSize(canvWidth,canvHeight);renderer.domElement.id="CanvasRenderer";document.getElementById("CanvasContainer").appendChild(renderer.domElement);renderer.domElement.style.width="100%";
renderer.domElement.style.height="100%";var CanvasRenderer=renderer.domElement;function exportImage(a){a=void 0===a?"":a;console.log("exporting image...");""==a&&(a=idfName);var b=CanvasRenderer.toDataURL("image/png").replace("image/png","image/octet-stream"),c=document.createElement("a");c.setAttribute("href",b);c.setAttribute("download",a+".png");document.body.appendChild(c);c.click();c.remove()}
var settingsPanelContent=document.getElementById("SettingsPanelContent"),visibilityPanelContent=document.getElementById("VisibilityPanelContent"),settingsPanelBlockZones=document.getElementById("SettingsPanelBlockZones"),sttgsShading=document.getElementById("SttgsShading"),sttgsLineThkCheckbox=document.getElementById("SttgsLineThkCheckbox"),sttgsLineThkInputfield=document.getElementById("SttgsLineThkInputfield"),sttgsHiddenMatType=document.getElementById("SttgsHiddenMatType"),sttgsShadow=document.getElementById("SttgsShadow"),
sttgsDebug=document.getElementById("SttgsDebug"),shadingOn=DEFAULTS.shadingOn;function turnOnShading(a){shadingOn=a;sttgsShading.checked=a;updateModel(force=!0,source="turnOnShading")}var shadowOn=DEFAULTS.shadowOn,selfShadow=DEFAULTS.selfShadow;function turnOnShadow(a){shadowOn=a;sttgsShadow.checked=a;renderer.shadowMap.enabled=a;lightShadow.castShadow=a;shadowOn&&updateShadowProperties();updateModel(force=!0,source="turnOnShadow")}
function turnOnSelfShadow(a){selfShadow=a;lightShadow.shadow.normalBias=selfShadow?-.1:0;a=$jscomp.makeIterator(sceneObjects.surfMesh);for(var b=a.next();!b.done;b=a.next())b.value.receiveShadow=selfShadow;updateModel(force=!0,source="turnOnSelfShadow")}
function updateShadowProperties(){updateCamera(force=!0,source="updateShadowProperties");lightShadow.shadow.radius=shadowRadius;lightShadow.shadow.mapSize.width=shadowMapSize;lightShadow.shadow.mapSize.height=shadowMapSize;turnOnSelfShadow(selfShadow);lightShadow.shadow.map&&lightShadow.shadow.map.dispose();lightShadow.shadow.map=null}var debugOn=DEFAULTS.debugOn;function turnOnDebug(a){debugOn=a;sttgsDebug.checked=a;updateModel(force=!0,source="turnOnDebug")}
var lineThicknessOn=DEFAULTS.lineThicknessOn,lineThickness=DEFAULTS.lineThickness,MAXLINETHICKNESS=5*canvMult,absoluteLineThickness=NaN;
function turnOnLineThickness(a){lineThicknessOn=a;sttgsLineThkCheckbox.checked=a;sttgsLineThkInputfield.disabled=!lineThicknessOn;lineThicknessOn?(sttgsLineThkInputfield.value=lineThickness,sttgsLineThkInputfield.type="number",updateAbsoluteLineThickness()):(sttgsLineThkInputfield.type="text",sttgsLineThkInputfield.value="-");updateModel(force=!0,source="turnOnLineThickness")}
function updateAbsoluteLineThickness(){absoluteLineThickness=lineThickness*bldgRadius/camera.radius*1.4;matEdge2.linewidth=absoluteLineThickness}updateAbsoluteLineThickness();function updateLineThickness(a){isNaN(a)||(lineThickness=a=clamp(a,0,MAXLINETHICKNESS));lineThicknessOn&&(sttgsLineThkInputfield.value=lineThickness,sttgsLineThkInputfield.blur(),updateAbsoluteLineThickness());updateModel(force=!0,source="updateLineThickness")}
function updateLineThicknessInputfield(a,b){var c=parseFloat(b.value);void 0===a||"Escape"===a.key?(b.value=lineThickness,b.blur()):!0!==a&&"Enter"!==a.key||updateLineThickness(c)}var hiddenMatType=DEFAULTS.hiddenMatType,hiddenMatTypeOptions=["disable","wireframe","ghost"];
function changeHiddenMatType(a){hiddenMatTypeOptions.includes(a)?(sttgsHiddenMatType.value=a,sttgsHiddenMatType.blur(),hiddenMatType=a,updateModel(force=!0,source="changeHiddenMatType")):console.error('"'+a+'" is not a valid option for hidden objects material!')}
var sttgsMatTrans=document.getElementById("SttgsMatTrans"),sttgsOverrideMat=document.getElementById("SttgsOverrideMat"),materialBy=DEFAULTS.materialBy,sttgsBlockMatbyType=document.getElementById("SettingsPanelBlockMatbyType"),sttgsBlockMatbyConst=document.getElementById("SettingsPanelBlockMatbyConst");
function changeMaterialBy(a){Array.from(document.querySelectorAll("#SettingsPanelBlockMatBy .changeBackgroundColorBtn")).forEach(function(b){b.dataset.type==a?(b.classList.add("changeBgColorBtnHighlighted"),b.disabled=!0):(b.classList.remove("changeBgColorBtnHighlighted"),b.disabled=!1)});materialBy=a;switch(a){case "byType":sttgsBlockMatbyType.style.display="block";sttgsBlockMatbyConst.style.display="none";break;case "byConst":sttgsBlockMatbyType.style.display="none",sttgsBlockMatbyConst.style.display=
"block"}updateModel(force=!0,source="changeMaterialBy")}
for(var sttgsGroupMatbyType=document.getElementById("SttgGroupMatbyType"),sttgsMatTemplatebyType=document.getElementById("MatSettingsbyType"),matKeysbyType={Override:"Override",OuterWall:"Outer wall",InnerSurf:"Inner surface",OuterSurf:"Outer surface",Roof:"Roof",Ground:"Ground",Adiabatic:"Adiabatic",Window:"Window",Door:"Door",Shading:"Shading"},matKeysNotOverridden=["Window","Door","Shading"],sttgsMat={byType:{},byConst:{},byConstDefault:{}},$jscomp$loop$93={},$jscomp$iter$4=$jscomp.makeIterator(Object.entries(matKeysbyType)),
$jscomp$key$$jscomp$destructuring$var6=$jscomp$iter$4.next();!$jscomp$key$$jscomp$destructuring$var6.done;$jscomp$loop$93={$jscomp$loop$prop$matType$94:$jscomp$loop$93.$jscomp$loop$prop$matType$94},$jscomp$key$$jscomp$destructuring$var6=$jscomp$iter$4.next()){var $jscomp$destructuring$var6=$jscomp$key$$jscomp$destructuring$var6.value,$jscomp$destructuring$var7=$jscomp.makeIterator($jscomp$destructuring$var6);$jscomp$loop$93.$jscomp$loop$prop$matType$94=$jscomp$destructuring$var7.next().value;var matName=
$jscomp$destructuring$var7.next().value,matSettingItem=void 0;"Override"==$jscomp$loop$93.$jscomp$loop$prop$matType$94?matSettingItem=sttgsOverrideMat.parentElement.parentElement:(matSettingItem=sttgsMatTemplatebyType.content.cloneNode(!0),matSettingItem.querySelector(".settingsFlexSpan").dataset.tag=$jscomp$loop$93.$jscomp$loop$prop$matType$94,matSettingItem.querySelector(".matTypeTag").innerHTML="&nbsp;"+matName);var inputs=Object.fromEntries(Array.from(matSettingItem.querySelectorAll(".settingsInput")).map(function(a){return function(b,
c){b.name="input"+a.$jscomp$loop$prop$matType$94+["Opacity","Color"][c];return[["opacity","color"][c],b]}}($jscomp$loop$93))),defaultMatSetting=DEFAULTS.matSettings.byType[$jscomp$loop$93.$jscomp$loop$prop$matType$94];inputs.opacity.value=defaultMatSetting.opacity;inputs.opacity.placeholder=defaultMatSetting.opacity;inputs.color.value=defaultMatSetting.color;sttgsMat.byType[$jscomp$loop$93.$jscomp$loop$prop$matType$94]=inputs;"Override"!=$jscomp$loop$93.$jscomp$loop$prop$matType$94&&sttgsGroupMatbyType.appendChild(matSettingItem)}
function resetMaterials(a){var b=!1,c=!1;if("all"==a)c=b=!0;else if("byType"==a)b=!0;else if("byConst"==a)c=!0;else{console.error('"'+a+'" is not a valid option for material show type!');return}if(b)for(a=$jscomp.makeIterator(Object.entries(sttgsMat.byType)),b=a.next();!b.done;b=a.next()){var d=$jscomp.makeIterator(b.value);b=d.next().value;var e=d.next().value;d=DEFAULTS.matSettings.byType[b];e.opacity.value=d.opacity;e.color.value=d.color;b=materials.byType[b];b.opacity=d.opacity;b.color=hexToRgb(d.color);
b.transparent=1>d.opacity}if(c){c=$jscomp.makeIterator(Object.entries(sttgsMat.byConstDefault));for(a=c.next();!a.done;a=c.next())b=$jscomp.makeIterator(a.value),a=b.next().value,d=b.next().value,b=DEFAULTS.matSettings.templates[d.opacity.parentElement.dataset.template],d.opacity.value=b.opacity,d.color.value=b.color,a=materials.byConstDefault[a],a.opacity=b.opacity,a.color=hexToRgb(b.color),a.transparent=1>b.opacity;c=$jscomp.makeIterator(Object.entries(sttgsMat.byConst));for(a=c.next();!a.done;a=
c.next())b=$jscomp.makeIterator(a.value),a=b.next().value,d=b.next().value,b=DEFAULTS.matSettings.templates[d.opacity.parentElement.dataset.template],d.opacity.value=b.opacity,d.color.value=b.color,a=materials.byConst[a],a.opacity=b.opacity,a.color=hexToRgb(b.color),a.transparent=1>b.opacity}updateModel(force=!0,source="resetMaterials")}
function updateMatOpacity(a,b){var c=b.parentElement.dataset.by,d=b.parentElement.dataset.tag;if(void 0===a||"Escape"===a.key)b.value=matSettings[c][d].opacity,b.blur();else if(!0===a||"Enter"===a.key)a=clamp(parseFloat(b.value),0,1),b.value=a,matSettings[c][d].opacity=a,materials[c][d].opacity=a,materials[c][d].transparent=1>a,b.blur(),updateModel(force=!0,source="updateMatOpacity")}
function updateMatColor(a){var b=a.parentElement.dataset.by,c=a.parentElement.dataset.tag;a=a.value;matSettings[b][c].color=a;materials[b][c].color=hexToRgb(a);updateModel(force=!0,source="updateMatColor")}
function updateColorInputToggle(a){var b=!1,c=!1;if("all"==a)c=b=!0;else if("byType"==a)b=!0;else if("byConst"==a)c=!0;else{console.error('"'+a+'" is not a valid option for material show type!');return}if(b)for(a=$jscomp.makeIterator(Object.entries(sttgsMat.byType)),b=a.next();!b.done;b=a.next()){b=$jscomp.makeIterator(b.value);var d=b.next().value;b=b.next().value;var e=$jscomp.makeIterator([!0,!0]);e.next();e.next();overrideMatOn?"Override"==d?(d=transparencyOn,e=!0):e=matKeysNotOverridden.includes(d)?
d=!0:d=!1:"Override"==d?e=d=!1:(d=matKeysNotOverridden.includes(d)?!0:transparencyOn,e=!0);b.opacity.disabled=!d;b.color.disabled=!e}if(c)for(sttgsMat.byConstDefault.DefaultOpaque.opacity.disabled=!transparencyOn,c=$jscomp.makeIterator(Object.entries(sttgsMat.byConst)),a=c.next();!a.done;a=c.next())a=$jscomp.makeIterator(a.value),b=a.next().value,a=a.next().value,b=matSettings.byConst[b].enabled,d=transparencyOn,e=b,"Transparent"==a.opacity.parentElement.dataset.template&&(d=!0),b||(d=!1),a.opacity.disabled=
!d,a.color.disabled=!e}var transparencyOn=DEFAULTS.transparencyOn;function turnOnTransparentMat(a){transparencyOn=a;sttgsMatTrans.checked=a;updateColorInputToggle("all");updateModel(force=!0,source="turnOnTransparentMat")}var overrideMatOn=DEFAULTS.overrideMatOn;function overrideMaterials(a){overrideMatOn=a;sttgsOverrideMat.checked=a;updateColorInputToggle("byType");updateModel(force=!0,source="overrideMaterials")}
for(var sttgsGroupMatbyConst=document.getElementById("SttgGroupMatbyConst"),sttgsMatTemplatebyConst=document.getElementById("MatSettingsbyConst"),sttgsMatTemplatebyConstSeparator=document.getElementById("MatSettingsbyConstSeparator"),sttgGroupMatbyConstDefault=document.getElementById("SttgGroupMatbyConstDefault"),$jscomp$loop$95={},$jscomp$iter$10=$jscomp.makeIterator(Array.from(sttgGroupMatbyConstDefault.querySelectorAll(".settingsFlexSpan"))),$jscomp$key$matSettingItem=$jscomp$iter$10.next();!$jscomp$key$matSettingItem.done;$jscomp$loop$95=
{$jscomp$loop$prop$tag$96:$jscomp$loop$95.$jscomp$loop$prop$tag$96},$jscomp$key$matSettingItem=$jscomp$iter$10.next()){var matSettingItem$39=$jscomp$key$matSettingItem.value;$jscomp$loop$95.$jscomp$loop$prop$tag$96=matSettingItem$39.dataset.tag;var inputs$40=Object.fromEntries(Array.from(matSettingItem$39.querySelectorAll(".settingsInput")).map(function(a){return function(b,c){b.name="inputMatByType"+a.$jscomp$loop$prop$tag$96+["Opacity","Color"][c];return[["opacity","color"][c],b]}}($jscomp$loop$95))),
defaultMatSetting$41=DEFAULTS.matSettings.templates[matSettingItem$39.dataset.template];inputs$40.opacity.value=defaultMatSetting$41.opacity;inputs$40.opacity.placeholder=defaultMatSetting$41.opacity;inputs$40.color.value=defaultMatSetting$41.color;sttgsMat.byConstDefault[$jscomp$loop$95.$jscomp$loop$prop$tag$96]=inputs$40;matSettings.byConstDefault[$jscomp$loop$95.$jscomp$loop$prop$tag$96]=Object.assign({},defaultMatSetting$41);materials.byConstDefault[$jscomp$loop$95.$jscomp$loop$prop$tag$96]=new THREE.MeshPhongMaterial(Object.assign({},
defaultMatSetting$41,DEFAULTS.matSettings.common))}function resetMatByConst(){matSettings.byConst={};materials.byConst={};sttgsMat.byConst={};sttgsGroupMatbyConst.innerHTML=""}function addMatByConstSeparator(){var a=sttgsMatTemplatebyConstSeparator.content.cloneNode(!0);sttgsGroupMatbyConst.appendChild(a)}
function addMatByConst(a,b,c){c=void 0===c?!0:c;var d=sttgsMatTemplatebyConst.content.cloneNode(!0),e=d.querySelector(".settingsFlexSpan");e.dataset.tag=a;e.dataset.template=c?"Opaque":"Transparent";c=Object.fromEntries(Array.from(d.querySelectorAll("input")).map(function(b,c){b.name="inputMatByConst"+a+["Checkbox","Opacity","Color"][c];return[["checkbox","opacity","color"][c],b]}));e=c.checkbox.name.replace(/[.#:\[\]>]/g,"-");c.checkbox.id=e;var g=d.querySelector(".constTag");g.title=b;g.innerHTML=
"&nbsp;"+a;g.setAttribute("for",e);c.checkbox.checked=!1;b=matSettings.byConst[a];c.opacity.value=b.opacity;c.opacity.placeholder=b.opacity;c.color.value=b.color;sttgsMat.byConst[a]=c;sttgsGroupMatbyConst.appendChild(d)}function updateMatbyConstToggle(a){matSettings.byConst[a.parentElement.parentElement.dataset.tag].enabled=a.checked;updateColorInputToggle("byConst");updateModel(force=!0,source="updateMatEnabled")}
function toggleMatByConstAll(a){for(var b=$jscomp.makeIterator(Object.entries(sttgsMat.byConst)),c=b.next();!c.done;c=b.next()){c=$jscomp.makeIterator(c.value);var d=c.next().value;c.next().value.checkbox.checked=a;matSettings.byConst[d].enabled=a}updateColorInputToggle("byConst");updateModel(force=!0,source="toggleMatByConstAll")}function updateColorInputByConstToggle(){}
function resetSettings(){updateModelLock=!0;turnOnShading(DEFAULTS.shadingOn);turnOnDebug(DEFAULTS.debugOn);turnOnLineThickness(DEFAULTS.lineThicknessOn);updateLineThickness(DEFAULTS.lineThickness);changeMaterialBy(DEFAULTS.materialBy);turnOnTransparentMat(DEFAULTS.transparencyOn);overrideMaterials(DEFAULTS.overrideMatOn);resetMaterials("all");changeVisFilter(DEFAULTS.visFilterType);selfShadow=DEFAULTS.selfShadow;shadowRadius=DEFAULTS.shadowRadius;shadowMapSize=DEFAULTS.shadowMapSize;shadowOffset=
[].concat($jscomp.arrayFromIterable(DEFAULTS.shadowOffset));turnOnShadow(DEFAULTS.shadowOn);updateModelLock=!1;updateModel(force=!0,source="resetSettings")}var updateModelLock=!1,lastModelUpdated=Date.now();function updateModel(a,b){a=void 0===a?!1:a;b=void 0===b?null:b;if(!updateModelLock){var c=Date.now();if(a||(c-lastModelUpdated)/1E3>REFRESHRATE)lastModelUpdated=c,resetScene(),renderModel(),DEV&&console.log("model updated - "+(b||"?")+", "+a)}}
function updatePanels(){settingsPanelContent.scrollTo(0,0);visibilityPanelContent.scrollTo(0,0);for(var a="",b=$jscomp.makeIterator(Object.entries(zoneList)),c=b.next();!c.done;c=b.next()){c=$jscomp.makeIterator(c.value);var d=c.next().value;c.next();a+='<label><input type="checkbox" data-zone="'+d+'" onclick="changeZoneVisibility(this);" checked> '+d+"</label>"}settingsPanelBlockZones.innerHTML=a}
function polarCoord(a,b){a=Math.radians(a);b=Math.radians(-b-90);return new THREE.Vector3(Math.cos(a)*Math.cos(b),Math.cos(a)*Math.sin(b),Math.sin(a))}var maxZoom=950,lastRendered=Date.now();
function updateCamera(a,b){a=void 0===a?!1:a;b=void 0===b?null:b;camera.alt=clamp(camera.alt,-90,90);camera.radius=clamp(camera.radius,1,maxZoom);lineThicknessOn&&updateAbsoluteLineThickness();camera.azm%=360;var c=camera.azm;camStepped&&(c=45*Math.round(camera.azm/45));camera.position.copy(polarCoord(camera.alt,c).multiplyScalar(camera.radius).add(camera.base));camera.lookAt(camera.base);90==Math.abs(camera.alt)&&(camera.rotation.z=Math.radians(-Math.sign(camera.alt)*c));lightDirect.position.copy(polarCoord(camera.alt,
c+45).add(camera.base));lightDirectTarget.position.copy(camera.base);lightShadow.position.copy(polarCoord(shadowOffset[0],c+shadowOffset[1]).multiplyScalar(camera.radius).add(bldgCenter));objDev.position.copy(polarCoord(45,c+90).multiplyScalar(10).add(camera.base));c=Date.now();if(a||(c-lastRendered)/1E3>REFRESHRATE)lastRendered=c,renderer.render(scene,camera),DEV&&console.log("refreshed - "+(b||"?")+", "+a)}
var clickable=!1,mouseLeft=!1,mouseMiddle=!1,shiftKey=!1,camStepped=!1,camFixed=!1,commandOn=!1,startX=null,startY=null,pressedKeys={};CanvasContainer.ondragstart=function(){return!1};
function customOnMouseMove(a){var b=a.pageX;a=a.pageY;var c=b-startX,d=a-startY;if(mouseLeft)camera.azm+=c/panelWidth*180,camera.alt+=d/panelHeight*180;else if(mouseMiddle){var e=Math.radians(camera.alt),g=-Math.radians(camera.azm+180);c=c/panelWidth*camera.radius/2;d=d/panelWidth*camera.radius/2;e=new THREE.Vector3(Math.cos(g)*c+Math.sin(e)*Math.sin(g)*d,Math.sin(g)*c-Math.sin(e)*Math.cos(g)*d,Math.cos(e)*d);camera.base.add(e)}updateCamera(force=!1,source="customOnMouseMove");startX=b;startY=a}
CanvasRenderer.onmousedown=function(a){startX=a.pageX;startY=a.pageY;0==a.button&&(mouseLeft=!0,mouseMiddle=!1);if(1==a.button||2==a.button)mouseMiddle=!0,mouseLeft=!1;document.addEventListener("mousemove",customOnMouseMove);document.onmouseup=function(a){mouseMiddle=mouseLeft=!1;camStepped&&(camera.azm=45*Math.round(camera.azm/45));document.removeEventListener("mousemove",customOnMouseMove)}};document.addEventListener("onmouseleave",function(){document.removeEventListener("mousemove",customOnMouseMove)});
CanvasContainer.onwheel=function(a){clickable&&(camera.radius-=a.wheelDeltaY/100*clamp(Math.pow(camera.radius/50,1.2),1,Infinity),updateCamera(force=!0,source="onwheel"))};document.getElementById("PageWrapper").onwheel=function(a){a=a||window.event;if("CanvasRenderer"==a.target.id&&clickable)return!1};document.getElementById("PageWrapper").onmousedown=function(a){a=a||window.event;if((1==a.button||2==a.button)&&"CanvasRenderer"==a.target.id)return!1};
document.onkeydown=function(a){var b=a.key.toLowerCase(),c=a.code;"/"==b&&a.preventDefault();a.shiftKey&&(shiftKey=!0);mouseLeft&&a.shiftKey&&(camStepped=!0,updateCamera(force=!0,source="onkeydown"));commandOn||"input"==a.target.tagName.toLowerCase()||(""!==idfName&&"KeyS"==c&&exportImage(),"KeyR"==c&&centerCamera(),""!==idfName&&a.ctrlKey&&a.shiftKey&&("KeyC"==c||"KeyV"==c)&&(a.preventDefault(),"KeyC"==c&&panelVisibility(copyPanel,1),"KeyV"==c&&loadSettings()))};var nonCommandKey="Shift Alt Control Enter Escape Tab CapsLock ContextMenu".split(" ");
document.onkeyup=function(a){switch(a.key){case "Shift":camStepped=shiftKey=!1;updateCamera(force=!0,source="onkeyup(shift)");break;case "/":commandOn||commandListenerVisibility(1);break;case "Enter":"visible"==copyPanel.style.visibility&&copySettings();break;case "Escape":commandOn?commandListenerVisibility(0):(panelVisibilityAll(-1),""==idfName?settingsPanelVisibility(-1):settingsPanelVisibility(0))}};var raycaster=new THREE.Raycaster;raycaster.layers.set(1);
var pointer=new THREE.Vector2,objectDisplay=document.getElementById("objectDisplay"),lastHighlightedObj=null,lastHighlightedObjMat=null,matHighlighted=new THREE.MeshPhongMaterial({color:"#ff0000",side:THREE.DoubleSide,opacity:.7,transparent:!0}),highlightedObjDisplayText="",lastSelectedObj=null,lastSelectedObjMat=null,matSelected=new THREE.MeshPhongMaterial({color:"#ff0000",side:THREE.DoubleSide,opacity:.8,transparent:!0}),selectedObjDisplayText="";
function objectHighlight(a){if(!mouseLeft&&!mouseMiddle){var b=a.target.getBoundingClientRect(),c=a.pageY-b.top;a=2*clamp((a.pageX-b.left)/mainPanelWidth,0,1)-1;c=2*-clamp(c/mainPanelHeight,0,1)+1;pointer.x=a;pointer.y=c;raycaster.setFromCamera(pointer,camera);c=raycaster.intersectObjects(scene.children);if((0<c.length?c[0].object:null)!==lastHighlightedObj){lastHighlightedObj&&(lastHighlightedObj.material=lastHighlightedObjMat,lastSelectedObj&&(lastSelectedObj.material=matSelected));if(0==c.length)objectDisplay.innerHTML=
"",lastHighlightedObj=null;else if(lastHighlightedObj!==c[0].object){lastHighlightedObj=a=c[0].object;lastHighlightedObjMat=a.material.clone();a.material=matHighlighted;c=a.sourceObjName;a=a.sourceObjType;var d="<b>[Name]</b> "+c;switch(a){case "surface":b=surfList[c];void 0!==b.OutsideBCObj&&""!=b.OutsideBCObj&&(d+=" ("+b.OutsideBCObj.toLowerCase()+")");d+="<br><b>[Type]</b> "+a+" ("+b.SurfaceType+")";d+="<br><b>[Construction]</b> "+b.Construction;d+="<br><b>[Zone]</b> "+b.ZoneName;d+="<br>  \u2514\u2500<b>[Surface]</b> "+
c;break;case "fenestration":b=fenList[c];void 0!==b.OutsideBCObj&&""!=b.OutsideBCObj&&(d+=" ("+b.OutsideBCObj.toLowerCase()+")");d+="<br><b>[Type]</b> "+a+" ("+b.SurfaceType+")";d+="<br><b>[Construction]</b> "+b.Construction;d+="<br><b>[Zone]</b> "+surfList[b.SurfaceName].ZoneName;d+="<br>  \u2514\u2500<b>[Surface]</b> "+b.SurfaceName;d+="<br>     \u2514\u2500<b>[Fenestration]</b> "+c;break;case "shading":d+="<br><b>[Type]</b> "+a}d=d.replaceAll(" ","&nbsp;");highlightedObjDisplayText=objectDisplay.innerHTML=
d}updateCamera(force=!0,source="objectHighlight")}}}CanvasRenderer.addEventListener("pointerleave",function(){null!==lastHighlightedObj&&(lastHighlightedObj.material=lastHighlightedObjMat,updateCamera(force=!0,source="pointerleave"));objectDisplay.innerHTML=""});
function resetBldgInfo(){readSuccess=!1;northAxis=0;boundary=[[Infinity,Infinity,Infinity],[-Infinity,-Infinity,-Infinity]];bldgRadius=0;bldgCenter=new THREE.Vector3;zoneList={};surfList={};fenList={};shadeList={};sceneObjects=Object.fromEntries(DEFAULTS.sceneObjectKeys.map(function(a){return[a,[]]}));shadowCatcher=null;resetMatByConst()}function resetCamera(){camera.base=new THREE.Vector3(0,0,0);camera.alt=20;camera.azm=-30;camera.radius=10;updateCamera(force=!0,source="resetCamera")}resetCamera();
function centerCamera(){resetCamera();camera.base.copy(bldgCenter);camera.radius=1.5*bldgRadius;updateCamera(force=!0,source="centerCamera")}
function resetScene(){scene.remove.apply(scene,scene.children);sceneObjects=Object.fromEntries(DEFAULTS.sceneObjectKeys.map(function(a){return[a,[]]}));scene.add(lightDirect);scene.add(lightDirectTarget);lightDirect.target=lightDirectTarget;scene.add(lightAmbient);scene.add(lightShadow);scene.add(lightShadowTarget);lightShadow.target=lightShadowTarget;DEV&&scene.add(objDev)}resetScene();
function triangulateSurfacefromFlatVertlist(a,b){b=void 0===b?null:b;var c=[];earcut(a.flat(),b,3).forEach(function(b){c.push(a[b])});return c}
function triangulatedSurfacefromVertlist(a,b){b=void 0===b?null:b;new THREE.Vector3(1,0,0);var c=new THREE.Vector3(0,0,1),d=new THREE.Vector3,e=new (Function.prototype.bind.apply(THREE.Vector3,[null].concat($jscomp.arrayFromIterable(a[0])))),g=new (Function.prototype.bind.apply(THREE.Vector3,[null].concat($jscomp.arrayFromIterable(a[1]))));g=(new THREE.Vector3).subVectors(g,e);for(var f=2;f<a.length&&!(d=new (Function.prototype.bind.apply(THREE.Vector3,[null].concat($jscomp.arrayFromIterable(a[f])))),
d=(new THREE.Vector3).subVectors(d,e),d=(new THREE.Vector3).crossVectors(d,g),d.length()>THRESHOLD);f++);e=new THREE.BufferGeometry;d.normalize();if((new THREE.Vector3).crossVectors(d,c).length()<THRESHOLD)a=new Float32Array(triangulateSurfacefromFlatVertlist(a,b).flat()),e.setAttribute("position",new THREE.BufferAttribute(a,3));else{var h=new THREE.Quaternion;h.setFromUnitVectors(d,c);var k=[];a.forEach(function(a){a=new (Function.prototype.bind.apply(THREE.Vector3,[null].concat($jscomp.arrayFromIterable(a))));
a.applyQuaternion(h);k.push([a.x,a.y,a.z])});a=new Float32Array(triangulateSurfacefromFlatVertlist(k,b).flat());e.setAttribute("position",new THREE.BufferAttribute(a,3));h.invert();e.applyQuaternion(h)}e.computeVertexNormals();return e}function loadExampleFile(){idfName=exampleIDFName;idfExt=exampleIDFExt;loadFile(exampleIDFCode)}window.onload=loadExampleFile;
function readFile(a){if(0<a.length){a=a[0];if(a.name.endsWith(".idf"))idfName=a.name.slice(0,-4),idfExt=".idf";else if(a.name.endsWith(".expidf"))idfName=a.name.slice(0,-7),idfExt=".expidf";else{window.alert("Only .idf, .expidf formats supported!");return}reader.readAsText(a,"utf-8")}}
function loadFile(a){CanvasRenderer.removeEventListener("pointermove",objectHighlight);settingsPanelVisibility(0);panelVisibilityAll(-1);camFixed||resetSettings();lastHighlightedObjMat=lastHighlightedObj=null;resetBldgInfo();parseIDF(a);hoverBtnVisibility(0);fileSelectorTag.innerHTML=""==idfName?"":idfName+idfExt;addModel();updatePanels();updateSliderRange(boundary[0][2],boundary[1][2],heightSliderGroup);CanvasRenderer.addEventListener("pointermove",objectHighlight)}var reader=new FileReader;
reader.onload=function(){loadFile(reader.result)};var fileSelector=document.getElementById("fileSelector"),fileSelectorTag=document.getElementById("fileSelectorTag");fileSelector.addEventListener("change",function(a){readFile(a.target.files)});document.body.addEventListener("drop",function(a){a.stopPropagation();a.preventDefault();clickable=!0;fileHoverMask.style.display="none";fileHover.style.display="none";readFile(a.dataTransfer.files)});
var fileHoverMask=document.getElementById("fileHoverMask"),fileHover=document.getElementById("fileHover"),fileHoverText=document.getElementById("fileHoverText");
document.body.addEventListener("dragover",function(a){a.stopPropagation();a.preventDefault();a.dataTransfer.dropEffect="copy";clickable=!1;fileHoverMask.style.display="block";fileHover.style.display="block";a.shiftKey?(camFixed=!0,fileHoverText.style.textShadow="#fff 0 0 10px, #ffe880 0 0 20px, #000 0 0 30px"):(camFixed=!1,fileHoverText.style.textShadow="#fff 0 0 10px, #80daff 0 0 20px, #000 0 0 30px")});
fileHoverMask.addEventListener("dragleave",function(a){camFixed=!1;clickable=!0;fileHoverMask.style.display="none";fileHover.style.display="none"});
function parseIDF(a){if(0>=a.length)return-1;a=a.replace(/!.*\s*/g,"");a=a.replace(/,\s*/g,",").replace(/;\s*/g,";").trim();a=a.split(";");iddInfoLibrary=null;for(var b="",c=0;c<a.length;c++){var d=a[c];if(d.toLowerCase().startsWith("version")){b=d.split(",")[1].split(".");c=[parseInt(b[0]),parseInt(b[1])];b=c[0]+"_"+c[1]+"_0";b in versionLibrary||(b=7>=c[0]?"7_2_0":Object.keys(versionLibrary)[Object.keys(versionLibrary).length-1]);console.log(b+".idd used.");break}}iddInfoLibrary=versionLibrary[b];
for(b=0;b<a.length;b++)if(c=a[b],c.toLowerCase().startsWith("building")){northAxis=parseFloat(c.split(",")[2]);break}a.forEach(function(a){if(a.toLowerCase().startsWith("zone")||a.toLowerCase().startsWith("construction")){a=a.split(",");var b=a[1];switch(a[0].toLowerCase()){case "zone":var c=iddInfoLibrary.zone;b in zoneList||(zoneList[b]={Surfaces:[],Origin:[Number(a[c.indexOf("x origin")]),Number(a[c.indexOf("y origin")]),Number(a[c.indexOf("z origin")])],NDirection:[],Visible:!0,ZBoundary:[Infinity,
-Infinity]})}}});var e=Object.keys(zoneList).map(function(a){return a.toLowerCase()}),g=!1;a.forEach(function(a){if(a.toLowerCase().startsWith("wall,")||a.toLowerCase().startsWith("wall:")||a.toLowerCase().startsWith("window,")||a.toLowerCase().startsWith("window:"))g||(g=!0,idfName="",settingsPanelVisibility(-1),window.alert('Currently only supports idf files using "BuildingSurface:Detailed".'));else if(a.toLowerCase().startsWith("buildingsurface:detailed")||a.toLowerCase().startsWith("fenestrationsurface:detailed")||
a.toLowerCase().startsWith("shading:building:detailed")){a=a.split(",");var b=a[1].toLowerCase();switch(a[0].toLowerCase()){case "buildingsurface:detailed":var c=iddInfoLibrary["buildingsurface:detailed"],d=a[c.indexOf("zone name")];d=e.indexOf(d.toLowerCase());d=Object.keys(zoneList)[d];for(var f=zoneList[d].Origin,h=c.indexOf("vertex 1 x-coordinate"),k=parseInt((a.length-h)/3),l=[],n=Infinity,p=-Infinity,m=0;m<k;m++){for(var t=[],q=0;3>q;q++){var r=f[q]+Number(a[h+3*m+q]);r<boundary[0][q]&&(boundary[0][q]=
r);r>boundary[1][q]&&(boundary[1][q]=r);t.push(r);2==q&&r<n&&(n=r);2==q&&p<r&&(p=r)}l.push(t)}f=[];b in surfList&&(f=surfList[b].Fenestrations);surfList[b]={SurfaceType:a[c.indexOf("surface type")].toLowerCase(),Construction:a[c.indexOf("construction name")],ZoneName:d,OutsideBC:a[c.indexOf("outside boundary condition")].toLowerCase(),OutsideBCObj:a[c.indexOf("outside boundary condition object")],VerticeNumber:k,Vertices:l,Fenestrations:f,ZBoundary:[n,p]};zoneList[d].Surfaces.push(b);n<zoneList[d].ZBoundary[0]&&
(zoneList[d].ZBoundary[0]=n);zoneList[d].ZBoundary[1]<p&&(zoneList[d].ZBoundary[1]=p);break;case "fenestrationsurface:detailed":c=iddInfoLibrary["fenestrationsurface:detailed"];d=a[c.indexOf("building surface name")].toLowerCase();k=zoneList[surfList[d].ZoneName].Origin;l=c.indexOf("vertex 1 x-coordinate");n=parseInt((a.length-l)/3);p=[];for(f=0;f<n;f++){h=[];for(m=0;3>m;m++)t=k[m]+Number(a[l+3*f+m]),t<boundary[0][m]&&(boundary[0][m]=t),t>boundary[1][m]&&(boundary[1][m]=t),h.push(t);p.push(h)}fenList[b]=
{SurfaceType:a[c.indexOf("surface type")].toLowerCase(),Construction:a[c.indexOf("construction name")],SurfaceName:d,OutsideBCObj:a[c.indexOf("outside boundary condition object")],VerticeNumber:n,Vertices:p};d in surfList?surfList[d].Fenestrations.push(b):surfList[d]={Fenestrations:[b]};break;case "shading:building:detailed":c=iddInfoLibrary["shading:building:detailed"].indexOf("vertex 1 x-coordinate");d=parseInt((a.length-c)/3);k=[];l=Infinity;n=-Infinity;for(p=0;p<d;p++){f=[];for(h=0;3>h;h++)m=
Number(a[c+3*p+h]),f.push(m),2==h&&m<l&&(l=m),2==h&&n<m&&(n=m);k.push(f)}shadeList[b]={VerticeNumber:d,Vertices:k,ZBoundary:[l,n]}}}});a=[];for(c=b=0;3>c;c++)a.push((boundary[0][c]+boundary[1][c])/2),b+=Math.pow(boundary[1][c]-boundary[0][c],2);bldgRadius=Math.sqrt(b);bldgCenter=new (Function.prototype.bind.apply(THREE.Vector3,[null].concat($jscomp.arrayFromIterable(a))));lightShadowTarget.position.copy(bldgCenter);addMatByConstSeparator();a=[];b=$jscomp.makeIterator(Object.entries(surfList));for(c=
b.next();!c.done;c=b.next()){d=$jscomp.makeIterator(c.value);c=d.next().value;var f=d.next().value;if(!(c in a||(c=f.Construction,c in materials.byConst))){var h=$jscomp.makeIterator(["",""]);d=h.next().value;h=h.next().value;var k="";"surface"==f.OutsideBC?(d=f.OutsideBCObj,a.push(d),d=surfList[d.toLowerCase()].Construction,c.toLowerCase()==d.toLowerCase()?k=d=c:(c=$jscomp.makeIterator(c.toLowerCase().includes("reverse")?[d,c]:[c,d]),d=c.next().value,h=c.next().value,k=d+" / "+h)):k=d=c;c=Object.assign({},
DEFAULTS.matSettings.templates.Opaque,{enabled:!1});matSettings.byConst[d]=c;materials.byConst[d]=new THREE.MeshPhongMaterial(Object.assign({},{color:c.color,opacity:c.opacity},DEFAULTS.matSettings.common));1==c.opacity&&(materials.byConst[d].transparent=!1);""!=h&&(matSettings.byConst[h]=matSettings.byConst[d],materials.byConst[h]=materials.byConst[d]);addMatByConst(d,k)}}addMatByConstSeparator();a=[];b=$jscomp.makeIterator(Object.entries(fenList));for(c=b.next();!c.done;c=b.next())d=$jscomp.makeIterator(c.value),
c=d.next().value,f=d.next().value,c in a||(c=f.Construction,c in materials.byConst||(h=$jscomp.makeIterator(["",""]),d=h.next().value,h=h.next().value,k="","surface"==surfList[f.SurfaceName].OutsideBC?(d=f.OutsideBCObj,a.push(d),d=fenList[d.toLowerCase()].Construction,c.toLowerCase()==d.toLowerCase()?k=d=c:(c=$jscomp.makeIterator(c.toLowerCase().includes("reverse")?[d,c]:[c,d]),d=c.next().value,h=c.next().value,k=d+" / "+h)):k=d=c,c=Object.assign({},DEFAULTS.matSettings.templates.Transparent,{enabled:!1}),
matSettings.byConst[d]=c,materials.byConst[d]=new THREE.MeshPhongMaterial(Object.assign({},{color:c.color,opacity:c.opacity},DEFAULTS.matSettings.common)),1==c.opacity&&(materials.byConst[d].transparent=!1),""!=h&&(materials.byConst[h]=materials.byConst[d]),addMatByConst(d,k,!1)));updateColorInputToggle("all");console.log("Done!");readSuccess=0<Object.keys(zoneList).length}
function addModel(){resetScene();camFixed||centerCamera();var a=boundary[1][0]-boundary[0][0],b=boundary[1][1]-boundary[0][1],c=Math.max(a,b),d=new THREE.BufferGeometry;a=new Float32Array([boundary[0][0]-a,boundary[0][1]-b,-.01,boundary[1][0]+a,boundary[0][1]-b,-.01,boundary[1][0]+a,boundary[1][1]+b,-.01,boundary[0][0]-a,boundary[0][1]-b,-.01,boundary[1][0]+a,boundary[1][1]+b,-.01,boundary[0][0]-a,boundary[1][1]+b,-.01]);d.setAttribute("position",new THREE.BufferAttribute(a,3));d.computeVertexNormals();
shadowCatcher=new THREE.Mesh(d,shadowCatcherMat);shadowCatcher.receiveShadow=!0;shadowCatcher.renderOrder=2;shadowCatcher.position.z=0;lightShadow.shadow.camera=new THREE.OrthographicCamera(-c,c,c,-c,.5,1E3);c=new THREE.Vector3(boundary[0][0]-.1*bldgRadius,boundary[0][1]-.1*bldgRadius,0);axisXObject=axisXObjTemplate.clone();axisXObject.translateX(c.x);axisXObject.translateY(c.y);axisYObject=axisYObjTemplate.clone();axisYObject.translateX(c.x);axisYObject.translateY(c.y);axisZObject=axisZObjTemplate.clone();
axisZObject.translateX(c.x);axisZObject.translateY(c.y);axisTrueNorthObject=axisTrueNorthObjTemplate.clone();axisTrueNorthObject.translateX(c.x);axisTrueNorthObject.translateY(c.y);axisTrueNorthObject.rotateZ(Math.radians(northAxis));c={};d=$jscomp.makeIterator(Object.entries(surfList));for(a=d.next();!a.done;c={$jscomp$loop$prop$holes$98:c.$jscomp$loop$prop$holes$98,$jscomp$loop$prop$vertList$99:c.$jscomp$loop$prop$vertList$99,$jscomp$loop$prop$points$100:c.$jscomp$loop$prop$points$100,$jscomp$loop$prop$positions$101:c.$jscomp$loop$prop$positions$101},
a=d.next()){b=$jscomp.makeIterator(a.value);a=b.next().value;b=b.next().value;c.$jscomp$loop$prop$vertList$99=b.Vertices;c.$jscomp$loop$prop$holes$98=null;0<b.Fenestrations.length&&(c.$jscomp$loop$prop$holes$98=[],b.Fenestrations.forEach(function(a){return function(b){b=fenList[b];a.$jscomp$loop$prop$holes$98.push(a.$jscomp$loop$prop$vertList$99.length);a.$jscomp$loop$prop$vertList$99=a.$jscomp$loop$prop$vertList$99.concat(b.Vertices)}}(c)));var e=triangulatedSurfacefromVertlist(c.$jscomp$loop$prop$vertList$99,
c.$jscomp$loop$prop$holes$98);surfList[a].Geometries=e;c.$jscomp$loop$prop$points$100=[];c.$jscomp$loop$prop$positions$101=[];b.Vertices.forEach(function(a){return function(b){a.$jscomp$loop$prop$points$100.push(new THREE.Vector3(b[0],b[1],b[2]));a.$jscomp$loop$prop$positions$101.push.apply(a.$jscomp$loop$prop$positions$101,$jscomp.arrayFromIterable(b))}}(c));c.$jscomp$loop$prop$points$100.push(c.$jscomp$loop$prop$points$100[0]);c.$jscomp$loop$prop$positions$101.push(c.$jscomp$loop$prop$positions$101[0],
c.$jscomp$loop$prop$positions$101[1],c.$jscomp$loop$prop$positions$101[2]);e=(new THREE.BufferGeometry).setFromPoints(c.$jscomp$loop$prop$points$100);surfList[a].EdgeObjects=new THREE.Line(e,matEdge);e=new LineGeometry;e.setPositions(c.$jscomp$loop$prop$positions$101);surfList[a].EdgeObjects2=new Line2(e,matEdge2);surfList[a].EdgeObjects2.renderOrder=0;b=triangulatedSurfacefromVertlist(b.Vertices);b=new THREE.Mesh(b,matGhost);b.castShadow=!0;b.material.colorWrite=!1;b.renderOrder=Infinity;surfList[a].ShadowObjects=
b}c={};d=$jscomp.makeIterator(Object.entries(fenList));for(a=d.next();!a.done;c={$jscomp$loop$prop$points$73$103:c.$jscomp$loop$prop$points$73$103,$jscomp$loop$prop$positions$74$104:c.$jscomp$loop$prop$positions$74$104},a=d.next())b=$jscomp.makeIterator(a.value),a=b.next().value,b=b.next().value,e=triangulatedSurfacefromVertlist(b.Vertices),e.computeVertexNormals(),fenList[a].Geometries=e,c.$jscomp$loop$prop$points$73$103=[],c.$jscomp$loop$prop$positions$74$104=[],b.Vertices.forEach(function(a){return function(b){a.$jscomp$loop$prop$points$73$103.push(new THREE.Vector3(b[0],
b[1],b[2]));a.$jscomp$loop$prop$positions$74$104.push.apply(a.$jscomp$loop$prop$positions$74$104,$jscomp.arrayFromIterable(b))}}(c)),c.$jscomp$loop$prop$points$73$103.push(c.$jscomp$loop$prop$points$73$103[0]),c.$jscomp$loop$prop$positions$74$104.push(c.$jscomp$loop$prop$positions$74$104[0],c.$jscomp$loop$prop$positions$74$104[1],c.$jscomp$loop$prop$positions$74$104[2]),b=(new THREE.BufferGeometry).setFromPoints(c.$jscomp$loop$prop$points$73$103),fenList[a].EdgeObjects=new THREE.Line(b,matEdge),b=
new LineGeometry,b.setPositions(c.$jscomp$loop$prop$positions$74$104),fenList[a].EdgeObjects2=new Line2(b,matEdge2),fenList[a].EdgeObjects2.renderOrder=0;c={};d=$jscomp.makeIterator(Object.entries(shadeList));for(a=d.next();!a.done;c={$jscomp$loop$prop$points$77$106:c.$jscomp$loop$prop$points$77$106},a=d.next())b=$jscomp.makeIterator(a.value),a=b.next().value,b=b.next().value,e=triangulatedSurfacefromVertlist(b.Vertices),e.computeVertexNormals(),shadeList[a].Geometries=e,c.$jscomp$loop$prop$points$77$106=
[],b.Vertices.forEach(function(a){return function(b){a.$jscomp$loop$prop$points$77$106.push(new THREE.Vector3(b[0],b[1],b[2]))}}(c)),c.$jscomp$loop$prop$points$77$106.push(c.$jscomp$loop$prop$points$77$106[0]),e=(new THREE.BufferGeometry).setFromPoints(c.$jscomp$loop$prop$points$77$106),shadeList[a].EdgeObjects=new THREE.Line(e,matEdge),b=triangulatedSurfacefromVertlist(b.Vertices),b=new THREE.Mesh(b,matGhost),b.castShadow=!0,b.material.colorWrite=!1,b.renderOrder=Infinity,shadeList[a].ShadowObjects=
b;renderModel()}
function renderModel(){shadowOn&&scene.add(shadowCatcher);for(var a=[],b=$jscomp.makeIterator(Object.entries(surfList)),c=b.next();!c.done;c=b.next()){var d=$jscomp.makeIterator(c.value);c=d.next().value;d=d.next().value;if(!a.includes(c)){var e=d.ZoneName,g=d.Geometries,f=void 0;if("byType"==materialBy)if(f=materials.byType.InnerSurf,overrideMatOn)f=materials.byType.Override;else{switch(d.OutsideBC){case "outdoors":switch(d.SurfaceType){case "wall":f=materials.byType.OuterWall;break;case "roof":f=
materials.byType.Roof;break;case "floor":f=materials.byType.OuterSurf}break;case "adiabatic":f=materials.byType.Adiabatic;break;case "ground":f=materials.byType.Ground}c.toLowerCase()==d.OutsideBCObj.toLowerCase()&&(f=materials.byType.Adiabatic)}else"byConst"==materialBy&&(f=d.Construction,f=matSettings.byConst[f].enabled?materials.byConst[f]:materials.byConstDefault.DefaultOpaque);f=f.clone();if("surface"==d.OutsideBC&&""!=d.OutsideBCObj){var h=d.OutsideBCObj.toLowerCase(),k=surfList[h].ZoneName;
if(isZoneVisible(e))a.push(h);else if(isZoneVisible(k)){a.push(c);continue}else a.push(h)}if(isZoneVisible(e))transparencyOn||(1>f.opacity&&(f.opacity=1),f.transparent=!1),e=new THREE.Mesh(g,f),e.renderOrder=1,e.layers.enable(1),e.sourceObjName=c,e.sourceObjType="surface",selfShadow&&(e.receiveShadow=!0),scene.add(e),sceneObjects.surfMesh.push(e),lineThicknessOn?scene.add(d.EdgeObjects2):scene.add(d.EdgeObjects),shadowOn&&null!=d.ShadowObjects&&scene.add(d.ShadowObjects);else switch(hiddenMatType){case "wireframe":scene.add(d.EdgeObjects);
break;case "ghost":c=new THREE.Mesh(g,DEFAULTS.matTemplates.Disabled),c.renderOrder=3,c.layers.enable(2),scene.add(c)}}}a=[];b=$jscomp.makeIterator(Object.entries(fenList));for(c=b.next();!c.done;c=b.next())if(d=$jscomp.makeIterator(c.value),c=d.next().value,d=d.next().value,!a.includes(c))if(e=surfList[d.SurfaceName],isZoneVisible(e.ZoneName)){""!=d.OutsideBCObj&&a.push(d.OutsideBCObj.toLowerCase());g=d.Geometries;f=void 0;if("byType"==materialBy)switch(f=materials.byType.Window,d.SurfaceType){case "door":f=
materials.byType.Door;break;case "glassdoor":f=materials.byType.Door}else"byConst"==materialBy&&(f=d.Construction,f=matSettings.byConst[f].enabled?materials.byConst[f]:materials.byConstDefault.DefaultTransparent);f=f.clone();g=new THREE.Mesh(g,f);g.renderOrder=1;g.layers.enable(1);g.sourceObjName=c;g.sourceObjType="fenestration";scene.add(g);lineThicknessOn&&["outdoors","ground"].includes(e.OutsideBC)?scene.add(d.EdgeObjects2):scene.add(d.EdgeObjects)}else"wireframe"==hiddenMatType&&scene.add(d.EdgeObjects);
a=$jscomp.makeIterator(Object.entries(shadeList));for(b=a.next();!b.done;b=a.next())if(c=$jscomp.makeIterator(b.value),b=c.next().value,c=c.next().value,d=c.Geometries,e=void 0,"byType"==materialBy?e=materials.byType.Shading.clone():"byConst"==materialBy&&(e=materials.byConstDefault.Shading),e=e.clone(),shadingOn&&isInsideHeightRange(c.ZBoundary))transparencyOn||(1>e.opacity&&(e.opacity=1),e.transparent=!1),d=new THREE.Mesh(d,e),d.layers.enable(1),d.sourceObjName=b,d.sourceObjType="shading",scene.add(d),
scene.add(c.EdgeObjects),shadowOn&&scene.add(c.ShadowObjects);else switch(hiddenMatType){case "wireframe":scene.add(c.EdgeObjects);break;case "ghost":b=new THREE.Mesh(d,DEFAULTS.matTemplates.Disabled),b.renderOrder=3,b.layers.enable(2),scene.add(b)}debugOn&&(scene.add(axisXObject),scene.add(axisYObject),scene.add(axisZObject),scene.add(axisTrueNorthObject));updateCamera(force=!0,source="renderModel")}
function changeBackgroundColor(a,b){a=void 0===a?-1:a;b=void 0===b?null:b;Array.from(document.querySelectorAll("#SettingsPanelBlockBackground .changeBackgroundColorBtn")).forEach(function(a){a.classList.remove("changeBgColorBtnHighlighted");a.disabled=!1});b.classList.add("changeBgColorBtnHighlighted");b.disabled=!0;switch(a){case -1:CanvasContainer.style.backgroundColor="";objectDisplay.className="transparentmode";console.log('Background changed to "transparent"');break;case 0:CanvasContainer.style.backgroundColor=
"black";objectDisplay.className="blackmode";console.log('Background changed to "black"');break;case 1:CanvasContainer.style.backgroundColor="white",objectDisplay.className="whitemode",console.log('Background changed to "white"')}}var visFilterType=DEFAULTS.visFilterType,visByZones=document.getElementById("VisByZones"),visByHeight=document.getElementById("VisByHeight");
function changeVisFilter(a){Array.from(document.querySelectorAll("#SettingsPanelBlockVisFilter .changeBackgroundColorBtn")).forEach(function(b){b.dataset.type==a?(b.classList.add("changeBgColorBtnHighlighted"),b.disabled=!0):(b.classList.remove("changeBgColorBtnHighlighted"),b.disabled=!1)});visFilterType=a;switch(a){case "zones":visByZones.style.display="block";visByHeight.style.display="none";break;case "height":visByZones.style.display="none";visByHeight.style.display="block";break;case "both":visByZones.style.display=
"none",visByHeight.style.display="none"}updateModel(force=!0,source="changeVisFilter")}function isZoneVisible(a){a=zoneList[a];switch(visFilterType){case "zones":return a.Visible;case "height":return isInsideHeightRange(a.ZBoundary);case "both":return a.Visible&isInsideHeightRange(a.ZBoundary);default:return!1}}
function isInsideHeightRange(a){if("zones"==visFilterType)return!0;var b=$jscomp.makeIterator(getSliderValues(heightSliderGroup)),c=b.next().value;b=b.next().value;return a[0]<=b&&c<=a[1]}
function changeZoneAll(a){for(var b=$jscomp.makeIterator(Object.entries(zoneList)),c=b.next();!c.done;c=b.next())c=$jscomp.makeIterator(c.value),c.next(),c.next().value.Visible=a;b=$jscomp.makeIterator(settingsPanelBlockZones.querySelectorAll("input[type=checkbox]"));for(c=b.next();!c.done;c=b.next())c.value.checked=a;updateModel(force=!0,source="changeZoneAll")}function changeZoneVisibility(a){zoneList[a.dataset.zone].Visible=a.checked;updateModel(force=!0,source="changeZoneVisibility")}
var fromSlider=document.querySelector("#fromSlider"),toSlider=document.querySelector("#toSlider"),fromInput=document.querySelector("#fromInput"),toInput=document.querySelector("#toInput"),sliderBackground=document.querySelector("#SliderBackground"),heightSliderGroup=[fromSlider,toSlider,fromInput,toInput,0,sliderBackground];resetSliderValue();fromSlider.oninput=function(){return updateFromValue(fromSlider.value,heightSliderGroup)};
fromSlider.onmouseup=function(){return updateModel(force=!0,source="fromSliderMouseUp")};toSlider.oninput=function(){return updateToValue(toSlider.value,heightSliderGroup)};toSlider.onmouseup=function(){return updateModel(force=!0,source="toSliderMouseUp")};fromInput.addEventListener("keydown",function(a){return updateSliderInput(a,fromInput,!0)});toInput.addEventListener("keydown",function(a){return updateSliderInput(a,toInput,!1)});
fromInput.addEventListener("focusout",function(){fromInput.value=getSliderValues(heightSliderGroup)[0]});toInput.addEventListener("focusout",function(){toInput.value=getSliderValues(heightSliderGroup)[1]});function resetSliderValue(){updateSliderValue(parseFloat(heightSliderGroup[0].min),parseFloat(heightSliderGroup[0].max),heightSliderGroup)}function updateSliderRange(a,b,c){a=roundFloat(a,2);b=roundFloat(b,2);c[0].min=a;c[0].max=b;c[1].min=a;c[1].max=b;resetSliderValue()}
function getSliderRange(a){return[parseFloat(a[0].min),parseFloat(a[0].max)]}function getSliderValues(a){return[parseFloat(a[0].value),parseFloat(a[1].value)]}function updateSliderInput(a,b,c){"Enter"===a.key&&(a.preventDefault(),c?updateFromValue(b.value,heightSliderGroup):updateToValue(b.value,heightSliderGroup));"Escape"===a.key&&(b.value=getSliderValues(heightSliderGroup)[c?0:1])}
function updateFromValue(a,b,c){c=void 0===c?!1:c;a=parseFloat(a);if(!isNaN(a)){var d=parseFloat(b[1].value);a>d-b[4]&&(a=d-b[4]);updateSliderValue(a,d,b,c)}}function updateToValue(a,b,c){c=void 0===c?!1:c;a=parseFloat(a);if(!isNaN(a)){var d=parseFloat(b[0].value);a<d+b[4]&&(a=d+b[4]);updateSliderValue(d,a,b,c)}}
function updateSliderValue(a,b,c,d){d=void 0===d?!1:d;a=roundFloat(a,2);b=roundFloat(b,2);c[0].value=a;c[1].value=b;c[2].value=a;c[3].value=b;c[0].style.zIndex=1;b==parseFloat(c[0].min)?c[1].style.zIndex=2:c[1].style.zIndex="";var e=$jscomp.makeIterator(getSliderRange(heightSliderGroup)),g=e.next().value;e=e.next().value-g;fillSlider((a-g)/e,(b-g)/e,c[5]);updateModel(force=d,source="updateSliderValue")}
function fillSlider(a,b,c){c.style.background="linear-gradient(\n        to right,\n        #112C4460 0%,\n        #112C4460 "+100*a+"%,\n        #112C44 "+100*a+"%,\n        #112C44 "+100*b+"%, \n        #112C4460 "+100*b+"%, \n        #112C4460 100%)"}var commandListener=document.getElementById("CommandListener");commandListenerVisibility(0);
function commandListenerVisibility(a){switch(void 0===a?0:a){case 0:commandOn=!1;commandListener.style.visibility="hidden";commandListener.style.opacity=0;commandListener.classList.remove("fadein");commandListener.classList.add("fadeout");break;case 1:commandOn=!0,commandListener.value="",commandListener.style.visibility="visible",commandListener.style.opacity=1,commandListener.classList.remove("fadeout"),commandListener.classList.add("fadein"),commandListener.classList.remove("CommandFail"),commandListener.classList.remove("CommandSuccess"),
commandListener.focus()}}var lastCommand="";function runCommandInput(a){a.metaKey||"ArrowUp"!=a.key||""==lastCommand||(commandListener.value=lastCommand);"Enter"===a.key&&(commandListenerVisibility(0),console.log(commandListener.value),runCommand(commandListener.value))}
function runCommand(a){lastCommand=a=(void 0===a?"":a).toLowerCase();commandListener.classList.add("CommandSuccess");switch(a){case "test":console.log("TEST!");break;case "help":panelVisibility(commandPanel,1);hoverBtnVisibility(-1);break;default:if(a.includes(" ")){var b=a.match(/(\S+)\s+(\S+)/);a=b[1];b=b[2];lastCommand=a+" ";switch(a){case "test":console.log("TEST! -",b);break;case "camerafar":b=parseFloat(b);if(isNaN(b)){commandFail();break}1E3>b&&(b=1E3);camera.far=b;camera.updateProjectionMatrix();
updateCamera(force=!0,source="runCommand");break;case "maxzoom":b=parseFloat(b);if(isNaN(b)){commandFail();break}950>b&&(b=950);maxZoom=b;camera.far=b+50;camera.updateProjectionMatrix();updateCamera(force=!0,source="runCommand");break;case "camerafov":b=parseFloat(b);if(isNaN(b)){commandFail();break}b=clamp(b,10,170);camera.fov=b;camera.updateProjectionMatrix();updateCamera(force=!0,source="runCommand");break;case "animatecamera":totalFrames=parseInt(b);if(isNaN(totalFrames)){commandFail();break}direction=
b.match(/[a-z]+$/);if("cw"==direction)clockwise=!0;else if("ccw"==direction)clockwise=!1;else{commandFail();break}animateFrame(totalFrames,animateCameraHorizontal,clockwise);break;case "animateheight":totalFrames=parseInt(b);if(isNaN(totalFrames)){commandFail();break}direction=b.match(/[a-z]+$/);if("up"==direction)bottomToTop=!0;else if("dn"==direction)bottomToTop=!1;else{commandFail();break}animateFrame(totalFrames,animateVisibleHeight,bottomToTop);break;case "shadowalt":b=parseFloat(b);if(isNaN(b)){commandFail();
break}shadowOffset[0]=b;updateCamera(force=!0,source="runCommand");break;case "shadowazm":b=parseFloat(b);if(isNaN(b)){commandFail();break}shadowOffset[1]=b;updateCamera(force=!0,source="runCommand");break;case "shadowmapsize":shadowMapSize=parseInt(b);if(isNaN(shadowMapSize)){commandFail();break}shadowOn&&updateShadowProperties();updateCamera(force=!0,source="runCommand");break;case "shadowradius":shadowRadius=parseFloat(b);if(isNaN(shadowRadius)){commandFail();break}shadowOn&&updateShadowProperties();
updateCamera(force=!0,source="runCommand");break;case "shadowheight":b=parseFloat(b);if(isNaN(b)){commandFail();break}shadowCatcher.translateZ(b-shadowCatcher.position.z);updateCamera(force=!0,source="runCommand");break;case "selfshadow":selfShadow="on"==b;updateShadowProperties();break;default:commandFail()}}else commandFail()}}function commandFail(){lastCommand="";commandListener.classList.remove("CommandSuccess");commandListener.classList.add("CommandFail")}
function toggleCopyCheckboxes(a,b){a=$jscomp.makeIterator(a.querySelectorAll("label"));for(var c=a.next();!c.done;c=a.next())c.value.querySelector("input").checked=b}
function settingsCode(a,b){switch(a){case "zv":if(b)b.includes("/")?(changeVisFilter("height"),a=b.split("/").map(Number),updateSliderValue.apply(null,[].concat($jscomp.arrayFromIterable(a),[heightSliderGroup,!0]))):changeVisFilter("zones");else switch(visFilterType){case "height":return a=getSliderValues(heightSliderGroup),a[0]+"/"+a[1];default:return"0"}break;case "sh":if(b)turnOnShading("1"==b);else return shadingOn?"1":"0";break;case "mt":if(b)turnOnTransparentMat("1"==b);else return transparencyOn?
"1":"0";break;case "om":if(b)overrideMaterials("1"==b);else return overrideMatOn?"1":"0";break;case "wo":if(b)updateWindowOpacity(parseFloat(b));else return String(windowOpacity);break;case "et":if(b)a=parseFloat(b),turnOnLineThickness(0<a),updateLineThickness(Math.abs(a));else return String(lineThickness*(lineThicknessOn?1:-1));break;case "hm":if(b)a=hiddenMatTypeOptions[parseInt(b)],changeHiddenMatType(a);else return String(hiddenMatTypeOptions.indexOf(hiddenMatType));break;case "st":if(b)turnOnShadow("1"==
b);else return shadowOn?"1":"0";break;case "ss":if(b)a=b.split("/"),shadowOffset[0]=parseFloat(a[0]),shadowOffset[1]=parseFloat(a[1]),shadowMapSize=parseInt(a[2]),shadowRadius=parseFloat(a[3]),shadowCatcher.translateZ(parseFloat(a[4])-shadowCatcher.position.z),selfShadow="1"==a[5],updateShadowProperties();else return[shadowOffset[0],shadowOffset[1],shadowMapSize,lightShadow.shadow.radius,shadowCatcher.position.z,selfShadow?"1":"0"].join("/");break;case "dg":if(b)turnOnDebug("1"==b);else return debugOn?
"1":"0";break;case "cp":if(b)a=b.split("/").map(Number),camera.base=new (Function.prototype.bind.apply(THREE.Vector3,[null].concat($jscomp.arrayFromIterable(a))));else return camera.base.x+"/"+camera.base.y+"/"+camera.base.z;break;case "ca":if(b)camera.alt=parseFloat(b);else return String(camera.alt);break;case "cz":if(b)camera.azm=parseFloat(b);else return String(camera.azm);break;case "cr":if(b)camera.radius=parseFloat(b);else return String(camera.radius);break;default:console.error('"'+b+'" is not a valid tag!')}}
function copySettings(){for(var a="##EPPrevSttgs##;",b=$jscomp.makeIterator(copyPanel.querySelectorAll("input")),c=b.next();!c.done;c=b.next())if(c=c.value,c.checked){c=c.dataset.tag;var d=settingsCode(c);a+=c+":"+d+";"}panelVisibility(copyPanel,-1);navigator.clipboard.writeText(a);console.log("Settings copied!")}
function loadSettings(){navigator.clipboard.readText().then(function(a){if(a.startsWith("##EPPrevSttgs##;")){a=$jscomp.makeIterator(a.split(";"));for(var b=a.next();!b.done;b=a.next())if(b=b.value,"##EPPrevSttgs##"!=b&&""!=b){var c=$jscomp.makeIterator(b.split(":"));b=c.next().value;c=c.next().value;settingsCode(b,c)}updateModel(force=!0,source="loadSettings");panelVisibilityAll(-1);console.log("Settings pasted!")}}).catch(function(a){console.error("Failed to read clipboard contents: ",a)})}
function animateFrame(a,b,c){for(var d=[],e=2;e<arguments.length;++e)d[e-2]=arguments[e];var g=function(){var a=new JSZip,b=k.map(function(b,c){return new Promise(function(d){b.toBlob(function(b){code=String(c).padStart(u,"0");a.file("frame_"+code+".png",b);d()})})});Promise.all(b).then(function(){a.generateAsync({type:"blob"}).then(function(a){var b=document.createElement("a");b.href=URL.createObjectURL(a);b.download=idfName+".zip";document.body.appendChild(b);b.click();document.body.removeChild(b);
URL.revokeObjectURL(b.href)})})},f=function(){if(l<a){var c=document.createElement("canvas");c.width=CanvasRenderer.width;c.height=CanvasRenderer.height;c.getContext("2d").drawImage(CanvasRenderer,0,0);k.push(c);b.apply(null,[l,a].concat($jscomp.arrayFromIterable(h)));updateCamera(force=!0,source="animateCameraHorizontal");setTimeout(f,25);l++}else g()},h=d;a=void 0===a?60:a;if(""!=idfName){var k=[],l=0,u=Math.ceil(Math.log10(a));f()}}
function animateCameraHorizontal(a,b,c){camera.azm+=360*(c?1:-1)/b}function animateVisibleHeight(a,b,c){changeVisFilter("height");var d=boundary[0][2],e=boundary[1][2];c?updateToValue((e-d)*a/b+d,heightSliderGroup,!0):updateToValue((e-d)*(1-a/b)+d,heightSliderGroup,!0)};
